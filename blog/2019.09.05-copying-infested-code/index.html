<!doctype html><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0, shrink-to-fit=no"><meta property=og:locale content=en_US><meta property=og:site_name content="Almost Engineer Services"><meta name=description content="The blog of Kenny Robinson where he shares his thoughts and experiences."><meta property=og:description content="The blog of Kenny Robinson where he shares his thoughts and experiences."><meta name=twitter:description content="The blog of Kenny Robinson where he shares his thoughts and experiences."><meta name=author content="Kenny Robinson, @almostengr"><title>Copying Infested Code | Almost Engineer Services</title><meta property=og:title content="Copying Infested Code"><meta name=twitter:title content="Copying Infested Code"><meta property=og:type content=website><meta name=robots content="index, follow"><link href=https://thealmostengineer.com/blog/2019.09.05-copying-infested-code/ rel=canonical><meta content=https://thealmostengineer.com/blog/2019.09.05-copying-infested-code/ property=og:url><script>
(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
    (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
    m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-64643711-1', 'thealmostengineer.com');
ga('send', 'pageview');
</script><script src=https://www.google.com/recaptcha/api.js async defer></script><script async src=https://kit.fontawesome.com/a076d05399.js></script><!-- Bootstrap core CSS --><link href=/css/bootstrap.css rel=stylesheet><link href=/css/almostengrtheme.css rel=stylesheet><style>
    .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    @media (min-width: 768px) {
        .bd-placeholder-img-lg {
            font-size: 3.5rem;
        }
    }
</style><!-- Custom styles for this template --><link href=/css/navbar-top-fixed.css rel=stylesheet><!-- <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> --><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css></head> <body> <header> <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-black"> <div> <a href=/ class="navbar-brand font-weight-bold">Almost Engineer Services</a> <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> </div> <div class="collapse navbar-collapse" id=navbarCollapse> <ul class="navbar-nav ml-auto"> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/about#handyman-services>Handyman</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/about#technology-services>Technical</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/blog>Blog</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/uses>Uses</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/contact>Contact</a> </li> </ul> <form class="mt-2 mt-md-0" method=GET action=/request> <button class="btn btn-outline-danger mx-2 text-uppercase" type=submit>Request Service</button> </form> </div> </nav> </header> <main role=main class="container py-2"> <div class=row> <div id=content-area class="col-sm-12 col-lg-8 border-lg-right border-dark"> <article> <h1 id=copying-infested-code>Copying Infested Code</h1> <p><img alt="Image of rotting wood" src=/images/2019.09.05-7863679378_028521b7fc_b.jpg></p> <h2 id=background>Background</h2> <p>As some of you may know, my current role consists of me building and maintaining automations. The thing about writing code is that at some point, maintenance has to be done on the code to keep it up to date and to add future enhancements and functionality. </p> <h2 id=what-kind-of-pest-the-problem>What Kind of Pest (The Problem)</h2> <p>Squirrels and rats both chew on wood. However they do not eat the same stuff, so you have to be selective with the bait that you choose. For most of the automations that I build, I use Selenium WebDriver as the automations are for web-based applications. </p> <p>Recently, we have noticed that number of automations have not been running due to “connection refused” exceptions. The connection is being refused from the automation jar not connecting to the Gecko Driver (the interface between WebDriver automation and the browser). Applying knowledge that I have of computers, normally you only see “connection refused” messages when one or more of the scenarios occur</p> <ul> <li>too many devices trying to connect at the same time, also referred to as Denial of Service Attack or Distributed Denial of Service Attack</li> <li>a firewall is rejecting the connection</li> <li>wrong password when trying to authenticate. </li> </ul> <h2 id=tracking-down-the-pest-the-analysis>Tracking Down The Pest (The Analysis)</h2> <p>I was able to immediately rule out scenarios 2 and 3 because the automation would work majority of the time. In other words, we know it is not a rat based on the evidence. Therefore, through the process of elimination, it must be a squirrel. Majority being that out of 7 days of the week that it was used, it would fail only on 1 of those days. I then did some research on the internet that provided a number of causes and solutions for the exception occurring. Some of the causes included </p> <ul> <li>the Gecko Driver process not being able to write to a log file because existing log file already exists (not in our case)</li> <li>having concurrent WebDriver automations running at the same time (which wasn’t our case as we have done several at the same time in the past)</li> <li>to the hosts file not having the localhost IP address entered (which we did not, but nslookup and ping commands both returned valid IP addresses)</li> <li>having bad code. </li> </ul> <p>I got to that last reason in the list, bad code, and I put more effort into looking into the code as we have experienced (2+ years) and inexperienced developers on our team. </p> <h2 id=found-the-nest-found-the-source-of-the-problem>Found The Nest (Found The Source Of The Problem)</h2> <p>After search through multiple automation projects, shaking my head at some of the exact examples of bad code mentioned in Robert Martin’s <em>Clean Code</em>, I hit the bullseye. Several of the automations had the same code. </p> <p>Yes… copied and pasted. First person got it working, so the next person got theirs working by doing exactly what the first person did. There's that saying about if you see one bug, there's probably another one not too far way. This would be it. To make it worse, it was multiplying everytime the code was copy and pasted. This is what I found: </p> <pre><code class=java>WebDriver driver = null;

try{    
    driver = new FirefoxDriver();
    driver.get(&quot;http://thealmostengineer.com&quot;);

    // other WebDriver steps go here 

    driver.quit();
    System.exit(0);
} catch (Exception exception) {
    exception.printStackTrace();
    System.exit(1);
}
</code></pre> <p>Now this is just a snippet of the actual code. Obviously, I cannot put the entire code here because of confidentiality. Do you notice the problem with this code? </p> <p>The problem here is that if an exception occurs between the <code>try</code> and <code>driver.quit();</code>, the browser and as a result, the Gecko Driver process never exits. What happens when you have too many processes running? The system will hang. What happens when there are too many connections open to a process? Some of those connections are refused. </p> <h2 id=spraying-the-bug-spray-the-solution>Spraying The Bug Spray (The Solution)</h2> <p>To now rid the varmint of our code, I had to fix the defect that I identified. The <code>driver.quit();</code> should always be executed regardless of whether the exception occurs. The reason being is that you do not want to the browser nor the Gecko Driver process running as they will hang up your system or result in the "connection refused" exceptions. So I changed the above code to the code below: </p> <pre><code class=java>WebDriver driver = null;
int exitCode = 1;

try{    
    driver = new FirefoxDriver();
    driver.get(&quot;http://thealmostengineer.com&quot;);

    // other WebDriver steps go here 

    exitCode = 0;
} catch (Exception exception) {
    exception.printStackTrace();
}

driver.quit();
System.exit(exitCode);
</code></pre> <p>The changes that I made: </p> <ul> <li>the <code>driver.quit();</code> has been moved outside of the try-catch block. That way it will always execute whether an exception occurs or not. Could a <code>finally</code>block been used? Yes. However, for the sake of simplifying the code I did not use one.</li> <li>I moved the <code>System.exit</code> call to the end of the code. It is best to have only one way to exit a function. If you have multiple ways to exit (or return) out of a function, code that needs to exit may not get executed because of the multiple ways out.</li> <li>I created a new integer variable called <code>exitCode</code>. Following standards for program exit code, 1 or greater means that something went wrong during execution. 0 means that everything went well during execution. Therefore, the variable defaults to 1 because you do not want your code to say that all went well when it actually did not. It is better to have a false failure and it get noticed than to have a false success and it go undetected. </li> </ul> <h2 id=conclusion>Conclusion</h2> <p>If you are going to copy the code of others, please be sure to review it first before using it as it may have defects already in it. If you do not know what the code does, then spend a few moments searching for those commands or snippets online so that you learn what they do. Using code somebody else wrote without confirming that it is not defective, is like building a chair from wood and not checking to see if it is rotting or has termites. </p> <p style="font-size: 0.9rem;font-style: italic;"> <a href=http://www.flickr.com/photos/63753633@N02/7863679378>"Rotting."</a> <span>by <a href=http://www.flickr.com/photos/63753633@N02>AisforAmy91</a> </span> is licensed under <a href="https://creativecommons.org/licenses/by-nd/2.0/?ref=ccsearch&atype=html" style="margin-right: 5px;">CC BY-ND 2.0</a> <a href="https://creativecommons.org/licenses/by-nd/2.0/?ref=ccsearch&atype=html" target=_blank rel="noopener noreferrer" style="display: inline-block;white-space: none;opacity: .7;margin-top: 2px;margin-left: 3px;height: 22px !important;"> <img style="height: inherit;margin-right: 3px;display: inline-block;" src=https://search.creativecommons.org/static/img/cc_icon.svg> <img style="height: inherit;margin-right: 3px;display: inline-block;" src=https://search.creativecommons.org/static/img/cc-by_icon.svg> <img style="height: inherit;margin-right: 3px;display: inline-block;" src=https://search.creativecommons.org/static/img/cc-nd_icon.svg></a> </p> <div class="bg-light my-3 p-3 rounded"> <strong>Published: </strong> 2019-09-05 <strong>Updated: </strong> 2020-07-15<br> <strong>Category:</strong> technology<br> </div> </article> </div> <!-- sidebar --> <div id=sidebar class="col-sm-12 col-lg-4 p-1"> <div class="mb-3 border border-dark rounded p-2 bg-dark text-gray"> <h4 class="text-left border-bottom border-white"> <span class="bg-white text-dark px-2 font-weight-bold">REQUEST SERVICE</span> </h4> <p>Do you have work that needs to be done and are ready to get started?</p> <p><a class="btn btn-danger" href=/request>GET STARTED!</a></p> </div> <div class="mb-3 border border-dark rounded bg-dark p-2 text-gray"> <h4 class="text-left border-bottom border-white"> <span class="bg-white text-dark px-2 font-weight-bold">BLOG</span> </h4> <p>Check out some of our past projects and work on our <a href=/blog>blog</a>!</p> </div> <div class="mb-3 border border-dark rounded bg-dark p-2"> <h4 class="text-left border-bottom border-white"> <span class="bg-white text-dark px-2 font-weight-bold">SPONSOR</span> </h4> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> </div> <!-- end sidebar --> </div> </main> <p class=container><a href=#top class="text-small text-red">Back to Top</a></p> <footer class="bg-black pt-3"> <div class="container px-0"> <div class="text-white col-12"> <ul class="list-unstyled list-inline"> <li class="px-2 bg-white list-inline-item text-dark font-weight-bold">SOCIAL</li> <li class="mr-2 list-inline-item text-capitalize"> <a href=https://github.com/almostengr target=_blank>github</a> </li> <li class="mr-2 list-inline-item text-capitalize"> <a href=https://instagram.com/almostengr target=_blank>instagram</a> </li> <li class="mr-2 list-inline-item text-capitalize"> <a href=https://stackoverflow.com/users/12875554/almostengr target=_blank>stack-overflow</a> </li> <li class="mr-2 list-inline-item text-capitalize"> <a href=https://twitter.com/almostengr target=_blank>twitter</a> </li> <li class="mr-2 list-inline-item text-capitalize"> <a href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1" target=_blank>youtube</a> </li> </ul> </div> <div class=col-12> <ul class="list-unstyled text-white"> <li class="px-2 bg-white text-dark font-weight-bold list-inline-item">LINKS</li> <li class="mr-2 list-inline-item"><a href=/about>About</a></li> <li class="mr-2 list-inline-item"><a href=/payment>Make Payment</a></li> <li class="mr-2 list-inline-item"><a href=/request>Request Service</a></li> <li class="mr-2 list-inline-item"><a href=/search>Search</a></li> <li class="mr-2 list-inline-item"><a href=/blog>Blog</a></li> <li class="mr-2 list-inline-item"><a href=/contact>Contact</a></li> <li class="mr-2 list-inline-item"><a href=/faq>FAQ</a></li> <li class="mr-2 list-inline-item"><a href=/sitemap.xml>Sitemap</a></li> <li class="mr-2 list-inline-item"><a href=/privacy>Privacy</a></li> </ul> </div> <div class=col-12> <ul class="list-unstyled text-white"> <li class="px-2 list-inline-item text-left bg-white text-dark font-weight-bold">SERVICES PROVIDED</li> <li class="mr-2 list-inline-item"><a href=/blog/2020.07.12-ceiling-fan-installation-with-downrod>Install Ceiling Fan</a></li> <li class="mr-2 list-inline-item"><a href=/blog/2019.07.30-reinforce-bookcase-with-plywood>Bookcase Assembly</a></li> <li class="mr-2 list-inline-item"><a href=/blog/2020.07.21-front-yard-landscaping>Landscaping</a></li> <li class="mr-2 list-inline-item"><a href=/blog/2018.07.21-how-to-replace-toilet-gasket-and-bolts>Toilet Repair</a></li> <li class="mr-2 list-inline-item"><a href=/blog/2018.06.19-replace-optical-drive-in-pc/ >Computer Repair</a></li> <li class="mr-2 list-inline-item"><a href=/blog/2020.03.01-linux-training-session/ >Linux Training</a></li> </ul> </div> <div class=col-12> <ul class="list-unstyled text-white"> <li class="px-2 list-inline-item text-left bg-white text-dark font-weight-bold"> <a class=text-dark href=/faq#what-areas-do-you-serve>SERVICE AREAS</a></li> <li class="mr-2 list-inline-item text-capitalize">Autauga County, Alabama</li> <li class="mr-2 list-inline-item text-capitalize">Elmore County, Alabama</li> <li class="mr-2 list-inline-item text-capitalize">Montgomery County, Alabama</li> <li class="mr-2 list-inline-item"><a href=/faq#what-areas-do-you-serve>Surrounding Areas</a></li> </ul> </div> </div> <hr class="text-white bg-white container"> <div class="text-center text-white bg-black pt-2 pb-5 px-2"> <p> Copyright &copy; 2015-2020 Almost Engineer Services </p> <p class=text-small> Cookies are used on this website to track your visits, provide advertisements specific to you, and preferences by a third-party. By continuing to use this site, you agree to the use of cookies unless you have disabled them. </p> </div> </footer> <script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script> <script>window.jQuery || document.write('<script src="js/vendor/jquery.slim.min.js"><\/script>')</script> <script src=/js/bootstrap.bundle.js></script> </body> </html>