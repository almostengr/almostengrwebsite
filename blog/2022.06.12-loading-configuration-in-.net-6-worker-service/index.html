<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="The blog of Kenny Robinson">
  <meta name="author" content="Kenny Robinson, @almostengr">
  <meta name="generator" content="Mkdocs">

  
  <title>Loading Configuration in .NET 6 Worker Service - The Almost Engineer</title>
  

  <link href="/assets/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/blog.min.css" rel="stylesheet">

  <meta property="og:type" content="website" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="The Almost Engineer" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="" />
  <meta name="twitter:creator" content="" />

  
  <meta name="description" content="The blog of Kenny Robinson">
  <meta property="og:description" content="The blog of Kenny Robinson" />
  <meta name="twitter:description" content="The blog of Kenny Robinson" />
  

  

  
  <meta name="keywords" content=".net 6, configuration, programming, csharp" />
  

  

  
  <meta name="robots" content="index, follow" />
  

  
  <link rel="canonical" href="https://thealmostengineer.com/blog/2022.06.12-loading-configuration-in-.net-6-worker-service/">
  <meta property="og:url" content="https://thealmostengineer.com/blog/2022.06.12-loading-configuration-in-.net-6-worker-service/" />
  <meta property="twitter:url" content="https://thealmostengineer.com/blog/2022.06.12-loading-configuration-in-.net-6-worker-service/" />
  

  
  <meta name="author" content="Kenny Robinson, @almostengr">
  

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="//www.googletagmanager.com/gtag/js?id="></script>
  <script
    async>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-64643711-1');</script>
</head>

<body class="bg-dark">
  <nav class="navbar navbar-expand-md navbar-dark bg-dark pb-2">
    <a class="navbar-brand" href="/">The Almost Engineer</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item"><a class="nav-link text-light" href="/blog">Blog</a></li>
        <li class="nav-item"><a class="nav-link text-light" href="/projects">Projects</a></li>
        <li class="nav-item"><a class="nav-link text-light" href="/resources">Get Into Tech</a></li>
        <li class="nav-item"><a class="nav-link text-light" href="https://lightshow.thealmostengineer.com">Light Show</a></li>
      </ul>

      
      <form class="form-inline mt-2 mt-md-0" action="https://www.google.com/search" method="get">
        <input type="hidden" name="q" value="site:thealmostengineer.com">
        <input class="form-control mr-sm-2" type="text" placeholder="Search with Google" aria-label="Search" name="q">
      </form>
      
    </div>
  </nav>

  <div class="bg-light pt-3 mb-0 pb-0">
    

    
    <main role="main" class="container">
  <div class="row">
    <div class="col-md-8 blog-main">
      
      <h1>Loading Configuration in .NET 6 Worker Service</h1>
      
      <p>I was updating the <a href="/projects/falcon-pi-twitter">Falcon Pi Twitter</a> project
from .NET 5 to .NET 6. As part of this upgrade, 
I created new projects so that I could use the templates that were designed for .NET 6. </p>
<p>Yes I could have used the .NET 5 template that came with Program.cs and Startup.cs, 
but I wanted to 
expand my knowledge of how to do things with only the Program.cs file that is provided 
as part of .NET 6 templates. This application is built using the Worker Service template.</p>
<p>With .NET 5, the configuration was part of the Startup class. Since there is no longer a
Startup class, I did not know where it should be placed. I did the research on 
<a href="https://stackoverflow.com/users/12875554/almostengr" target="_blank">Stack Overflow</a>
but did not come up with any answers.</p>
<p>After some time, I did figure out what needed to be done and wrote this post to share 
that same information and some of the challenges that I faced when setting things up. </p>
<h2 id="getting-the-appsettingsjson-loaded">Getting the appsettings.json Loaded</h2>
<p>With my projects, I usually have two appsettings.json files. One for production
and one for development configuration. Production file is called 
<code>appsettings.json</code> and the Development file is called <code>appsettings.Development.json</code>. </p>
<p>I found that you have to use the Configuration Builder to load the appsettings.json file. 
You do this by adding the following to the Program.cs file. </p>
<pre><code class="language-csharp">IConfiguration configuration = new ConfigurationBuilder()
    .AddJsonFile(&quot;appsettings.json&quot;, true, true)
    .Build();
</code></pre>
<p>You can add multiple JSON files to the configuration. For example, if you have a configuration 
file that is provided or used by another applicatoin, but also needs to be accessed by<br />
the application that you are building,
you can add another <code>AddJsonFile</code> line in the file for additional configurations.</p>
<p>Since I wanted to able to source appsettings.json for each environment, I updated the
<code>AddJsonFile</code> to </p>
<pre><code class="language-csharp">.AddJsonFile(&quot;appsettings.Development.json&quot;, true, true)
.AddJsonFile(&quot;appsettings.json&quot;, true, true)
</code></pre>
<p>The problem that I then found out, is that when you do this, the second configuration file 
listed will overwrite the values in the first configuration value listed. Thus if you are working 
in Development, you will be running with the Production configuration values, and that would 
not be the correct way of doing things.</p>
<p>I then added a configuration switcher based on the environment variable that is defined by 
the application. The code looks as follows: </p>
<pre><code class="language-csharp">string appSettingsFile = Environment.GetEnvironmentVariable(&quot;DOTNET_ENVIRONMENT&quot;) == &quot;Production&quot; ?
     &quot;appsettings.json&quot; : &quot;appsettings.Development.json&quot;;

IConfiguration configuration = new ConfigurationBuilder()
    .AddJsonFile(appSettingsFile, false, true)
    .Build();
</code></pre>
<p>To explain the lines above, the application is looking at the DOTNET_ENVIRONMENT variable, 
formerly ASPNETCORE_ENVIRONMENT variable in previous .NET versions, 
to determine which appsettings file to use. From that, the 
appsettings file is used in the configuration.</p>
<p>Note that the second parameter in the AddJsonFile is now set to false because we want the application
to throw an error if the correct appsettings.json file does not exist.</p>
<h2 id="use-appsettings-with-dependency-injection">Use AppSettings with Dependency Injection</h2>
<p>Now that we have the configuration loaded and in the Program.cs file, we can then use it via 
Dependency Injection (DI) in our application.</p>
<p>Inside of the ConfigureServices extension method of the IHost, add the following </p>
<pre><code class="language-csharp">AppSettings appSettings = configuration.GetSection(nameof(AppSettings)).Get&lt;AppSettings&gt;();
services.AddSingleton(appSettings);
</code></pre>
<h2 id="final-result">Final Result</h2>
<p>After doing the above, you should have a Program.cs file that looks similar to the below.</p>
<pre><code class="language-csharp">string appSettingsFile = Environment.GetEnvironmentVariable(&quot;DOTNET_ENVIRONMENT&quot;) == &quot;Production&quot; ?
     &quot;appsettings.json&quot; : &quot;appsettings.Development.json&quot;;

IConfiguration configuration = new ConfigurationBuilder()
    .AddJsonFile(appSettingsFile, false, true)
    .Build();

IHost host = Host.CreateDefaultBuilder(args)
    .ConfigureServices(services =&gt;
    {
        AppSettings appSettings = configuration.GetSection(nameof(AppSettings)).Get&lt;AppSettings&gt;();
        services.AddSingleton(appSettings);
    })
    .Build();

await host.RunAsync();
</code></pre>
<p>Then you can use the configuration when starting other services within the <code>ConfigureServices</code>
method and by referencing the appSettings variable 
or within your other classes by using Dependency Injection and passing in 
<code>AppSettings appSettings</code> as part of the class constructor.</p>

      

      <div class="text-muted py-2">
        

        
        <span>Posted: 2022-06-12</span>
        
      </div>
      <div class="text-muted pb-2">
        
        <div>Author: Kenny Robinson, @almostengr</div>
        
      </div>

      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4218270188842097" data-ad-slot="5189305512" data-ad-format="auto"
        data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div><!-- /.blog-main -->

    <aside class="col-md-4 blog-sidebar">
      <div class="p-4 mb-3 bg-light rounded shadow">
        <h4 class="font-italic">About Kenny</h4>
        <p class="mb-0">
          A software developer that builds and fixes things, and writes about the journey.
        </p>
      </div>
      <div class="p-4 shadow mb-3">
        <h4 class="font-italic">Get Into Tech</h4>
        <p class="mb-0">
          Are you looking to get into a tech career or role? Check out the
          <a href="/resources">Resources</a> section for more information. Also check out my
          <a href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1" target="_blank">
            Tech Talk YouTube Channel</a> and
          <a href="https://www.facebook.com/profile.php?id=100089303142244" target="_blank">
            Tech Talk Facebook page</a> for video tutorials about software development, web development,
          and working with tech.
          </a>
        </p>
      </div>
      <div class="p-4 shadow mb-3">
        <h4 class="font-italic">Connect with Me</h4>
        <ol class="list-unstyled">
          <li><a target="_blank" href="https://bluesky.com/almostengr.bsky.social">Blue Sky</a></li>
          <li><a target="_blank" href="https://www.fanbase.app/almostengr">Fanbase</a></li>
          <li><a target="_blank" href="https://github.com/almostengr">Github</a></li>
          <li><a target="_blank" href="https://facebook.com/rhtservicesllc">Home Improvement (Facebook)</a></li>
          <li><a target="_blank" href="https://www.youtube.com/c/RobinsonHandyandTechnologyServices?sub_confirmation=1">Home
              Improvement (YouTube)</a></li>
          <li><a target="_blank" href="https://instagram.com/almostengr">Instagram</a></li>
          <li><a target="_blank" href="https://www.youtube.com/channel/UCB7rvymUaUbbig3skv2zvCQ?sub_confirmation=1">Kenny Ram Dash Cam</a></li>
          <li><a target="_blank" href="https://stackoverflow.com/users/12875554/almostengr">StackOverflow</a></li>
          <li><a target="_blank" href="https://www.facebook.com/profile.php?id=100089303142244">Tech Talk (Facebook)</a></li>
          <li><a target="_blank" href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1">Tech Talk
              (YouTube)</a></li>
          <li><a target="_blank" href="https://www.tiktok.com/@almostengr">TikTok</a></li>
          <li><a target="_blank" href="https://twitter.com/almostengr">Twitter</a></li>
        </ol>
      </div>
      <div class="p-4 shadow mb-3">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4218270188842097" data-ad-slot="5189305512" data-ad-format="auto"
          data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
    </aside><!-- /.blog-sidebar -->
  </div><!-- /.row -->
</main><!-- /.container -->
<footer class="blog-footer bg-dark text-light text-left">
  <div class="container">
    <div>
      <a class="text-light pr-2" href="/blog">Blog</a>
      <a class="text-light pr-2" href="/projects">Projects</a>
      <a class="text-light pr-2" href="/resources">Get Into Tech</a>
      <a class="text-light pr-2" href="/services">Services</a>
      <a class="text-light pr-2" href="/blog">Food</a>
      <a class="text-light pr-2" href="/uses">Uses</a>
      <a class="text-light pr-2" href="/about">About</a>
      <a class="text-light pr-2" href="/contact">Contact</a>
      <a class="text-light pr-2" href="/privacy">Privacy Policy</a>
      <a class="text-light pr-2" href="/sitemap.xml">Sitemap</a>
    </div>
    <div>
      <a class="text-light pr-2" target="_blank" href="https://facebook.com/rhtservicesllc">Home Improvement (Facebook)</a>
      <a class="text-light pr-2" target="_blank" href="https://www.youtube.com/c/RobinsonHandyandTechnologyServices?sub_confirmation=1">Home
        Improvement (YouTube)</a>
      <a class="text-light pr-2" target="_blank" href="https://www.facebook.com/profile.php?id=100089303142244">Tech Talk (Facebook)</a>
      <a class="text-light pr-2" target="_blank" href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1">Tech Talk
        (YouTube)</a>
      <a class="text-light pr-2" target="_blank" href="https://www.youtube.com/channel/UCB7rvymUaUbbig3skv2zvCQ?sub_confirmation=1">Kenny Ram Dash
        Cam</a>
    </div>
    <div>
      <a class="text-light pr-2" target="_blank" href="https://bluesky.com/almostengr.bsky.social">Blue Sky</a>
      <a class="text-light pr-2" target="_blank" href="https://fanbase.app/almostengr">Fanbase</a>
      <a class="text-light pr-2" target="_blank" href="https://github.com/almostengr">Github</a>
      <a class="text-light pr-2" target="_blank" href="https://instagram.com/almostengr">Instagram</a>
      <a class="text-light pr-2" target="_blank" href="https://stackoverflow.com/users/12875554/almostengr">StackOverflow</a>
      <a class="text-light pr-2" target="_blank" href="https://www.tiktok.com/@almostengr">TikTok</a>
      <a class="text-light pr-2" target="_blank" href="https://twitter.com/almostengr">Twitter</a>
    </div>
    <div>Copyright &copy; 2010-2025 Kenny Robinson</div>
    <div>
      Created by <a class="text-light" href="https://rhtservices.net" target="_blank">Robinson Handy and Technology Services</a>
    </div>
    <div>
      Disclaimer: The opinions expressed here are those of mine and not representative of my employer or
      affiliates.
    </div>
  </div>
</footer>
    

  </div>
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <script type="text/javascript" src="/js/popper.min.js"></script>
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
</body>

</html>