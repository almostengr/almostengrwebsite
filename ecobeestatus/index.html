<!doctype html><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:site_name content="The Almost Engineer"><meta name=twitter:card content=summary><meta name=twitter:site content=@almostengr><meta name=twitter:creator content=@almostengr><meta name=description content="Provide project details about the Ecobee status automation"><meta property=og:description content="Provide project details about the Ecobee status automation"><meta name=twitter:description content="Provide project details about the Ecobee status automation"><meta name=author content="Kenny Robinson, @almostengr"><title>Ecobee Status Monitor | The Almost Engineer, The blog of Kenny Robinson</title><meta property=og:title content="Ecobee Status Monitor | The Almost Engineer, The blog of Kenny Robinson"><meta name=twitter:title content="Ecobee Status Monitor | The Almost Engineer, The blog of Kenny Robinson"><meta property=og:type content=website><meta name=robots content="index, follow"><link href=https://thealmostengineer.com/ecobeestatus/ rel=canonical><meta content=https://thealmostengineer.com/ecobeestatus/ property=og:url><meta content=https://thealmostengineer.com/ecobeestatus/ property=twitter:url><link href=/css/bootstrap.min.css rel=stylesheet><!-- Custom styles for this template --><link href="//fonts.googleapis.com/css?family=Playfair+Display:700,900" rel=stylesheet><link href=/css/theme.min.css rel=stylesheet><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css><link rel=stylesheet href=/css/a11y-dark-theme.min.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.min.css><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=manifest href=/images/site.webmanifest><!-- Global site tag (gtag.js) - Google Analytics --></head> <body class=bg-white> <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark-red"> <a class="navbar-brand font-weight-bold text-uppercase" href=/ title="The Almost Engineer, The blog of Kenny Robinson">The Almost Engineer</a> <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarCollapse> <ul class="navbar-nav mr-auto"> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/technology>Technology</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/handyman>Handyman</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href="https://www.youtube.com/c/kennythealmostengineer?sub_confirmation=1">YouTube</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/projects>Projects</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/services>Services</a> </li> </ul> <form class="form-inline mt-2 mt-md-0" action=/search2> <button class="btn btn-outline-light my-sm-0" type=submit>Search</button> </form> </div> </nav> <main role=main class=container> <div class=row> <div class="col-sm-12 col-md-9 blog-main"> <ul class="list-unstyled breadcrumb"> <li class=list-inline-item><a href=/ >Home</a></li> <li class=list-inline-item>&raquo; Ecobee Status Monitor</li> </ul> <h1 class=blog-post-title> Ecobee Status Monitor </h1> <!-- home page listing --> <p> </p> <div class=content> <h2 id=table-of-contents>Table of Contents</h2> <ul> <li><a href=#problem>Problem</a></li> <li><a href=#solution>Solution</a></li> <li><a href=#technology>Technology</a></li> <li><a href=#installation>Installation</a></li> <li><a href=#uninstall>Uninstall</a></li> <li><a href=#troubleshooting>Troubleshoot</a></li> </ul> <h2 id=problem>Problem</h2> <p>Home Assistant would report that there was a problem connecting to the Ecobee servers when a change was made to the thermostat from Home Assistant. Home Assistant does not (in May 2021) have the ability to check the status of the Ecobee API. It only just makes calls to the API.</p> <p><a href=#>Back to Top</a></p> <h2 id=solution>Solution</h2> <p>Since Ecobee had a couple of issues within the last couple of weeks when I attempted to make changes to the thermostat, I decided to build an automation that would update an indicator in Home Assistant to whether the Ecobee API status page was showing that everything is operational. </p> <p>If the "All Systems Operational" message is not shown on the Ecobee status page, then the Ecobee API Status indicator in Home Assistant is set to false. From there, automations can be triggered based on the state of the API. If the previously stated message is shown on the page, then the Home Assistant sensor will show true.</p> <p><a href=#>Back to Top</a></p> <h2 id=technology>Technology</h2> <p>This application was written with .NET Core 3.1 and Selenium WebDriver.</p> <p>Using Webdriver, it goes to the Ecobee API Status website and checks the text on the page. Then it updates the local Home Assistant instance based on whether it is true or false. This automation runs once per 10 minutes, but can be configured to run at other intervals.</p> <p><a href=#>Back to Top</a></p> <h2 id=installation>Installation</h2> <h3 id=copy-the-files>Copy The Files</h3> <p>Within VS Code, I have a task that does the deployment for me. That task does a build with release configuration and ssh file copy to the server that the code will be running from with a single command. You can see the <a href=https://github.com/almostengr/ecobeestatus/blob/main/.vscode/tasks.json target=_blank>tasks.json</a> file to see how this is done.</p> <h3 id=system-service>System Service</h3> <p>To have the application run on startup, I have configured it to run as a system service. To do this, you will need to do the following. </p> <pre><code class=language-sh>iamadmin@media:~/ecobeestatus$ sudo cp almostengr.ecobeestatus.service /lib/systemd/system
iamadmin@media:~/ecobeestatus$ sudo systemctl daemon-reload 
iamadmin@media:~/ecobeestatus$ sudo systemctl enable almostengr.ecobeestatus.service 
Created symlink /etc/systemd/system/multi-user.target.wants/almostengr.ecobeestatus.service → /lib/systemd/system/almostengr.ecobeestatus.service.
iamadmin@media:~/ecobeestatus$ sudo systemctl start almostengr.ecobeestatus.service 
</code></pre> <p>Last step is to confirm that the process is running. </p> <pre><code class=language-sh>iamadmin@media:~/ecobeestatus$ sudo systemctl status almostengr.ecobeestatus.service 
● almostengr.ecobeestatus.service - Ecobee Status Monitor by almostengr
     Loaded: loaded (/lib/systemd/system/almostengr.ecobeestatus.service; enabled; vendor preset: enabled)
     Active: active (running) since Tue 2021-05-04 06:48:20 CDT; 12s ago
       Docs: https://thealmostengineer.com/ecobeestatus
   Main PID: 223570 (Almostengr.Ecob)
      Tasks: 10 (limit: 38350)
     Memory: 35.2M
     CGroup: /system.slice/almostengr.ecobeestatus.service
             └─223570 /home/iamadmin/ecobeestatus/Almostengr.EcobeeStatus

May 04 06:48:20 media systemd[1]: Started Ecobee Status Monitor by almostengr.
</code></pre> <h3 id=appsettingsjson>appsettings.json</h3> <p>Provided with the code is the appsettings.template.json file. This file has all of the properties in it that are needed to run, but you have to enter the corresponding values for your installation.</p> <pre><code class=language-json>{
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;,
      &quot;Microsoft&quot;: &quot;Warning&quot;,
      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;
    }
  },
  &quot;AppSettings&quot;: {
    &quot;HomeAssistant&quot;: {
      &quot;Url&quot;: &quot;&lt;HA IP address&gt;&quot;,
      &quot;Token&quot;: &quot;&lt;HA token&gt;&quot;
    },
    &quot;EcobeeStatusUrl&quot;: &quot;https://status.ecobee.com&quot;
  }
}
</code></pre> <ul> <li>"HA IP Address" - this value should have the web address (with http or https included) to access your Home Assistant instance. </li> <li>"HA token" - this value needs to be replaced with the long-time token from Home Assistant. This token can be generated by logging into Home Assistant and going to your user profile.</li> </ul> <p>The other properties in the file do not need to be changed. If you would like additional logging to be done, then you can change the corresponding logging settings.</p> <p><a href=#>Back to Top</a></p> <h2 id=uninstall>Uninstall</h2> <p>To remove the application as a service, run the commands below.</p> <pre><code class=language-sh>iamadmin@media:~/ecobeestatus$ sudo systemctl disable almostengr.ecobeestatus
iamadmin@media:~/ecobeestatus$ sudo systemctl stop almostengr.ecobeestatus
iamadmin@media:~/ecobeestatus$ sudo systemctl status almostengr.ecobeestatus
iamadmin@media:~/ecobeestatus$ sudo rm /lib/systemd/system/almostengr.ecobeestatus
</code></pre> <p>Once you have ran the above commands, then you can remove the application files from the directory that you installed them in.</p> <p><a href=#>Back to Top</a></p> <h2 id=troubleshooting>Troubleshooting</h2> <h3 id=incorrect-path-in-service-file>Incorrect Path in Service File</h3> <p>I did encounter an error when setting up the system service. The problem was that the path that I had entered in the service file was incorrect. As a result, the daemon could not call the program to start. </p> <p>Below is the output that you will see if you have this error. The solution is to stop the service from running, fix the path in the service file, and then start the service again.</p> <pre><code class=language-sh>iamadmin@media:~/ecobeestatus$ sudo systemctl status almostengr.ecobeestatus.service 
● almostengr.ecobeestatus.service - Ecobee Status Monitor by almostengr
     Loaded: loaded (/lib/systemd/system/almostengr.ecobeestatus.service; enabled; vendor preset: enabled)
     Active: failed (Result: exit-code) since Tue 2021-05-04 06:46:10 CDT; 3s ago
       Docs: https://thealmostengineer.com/ecobeestatus
    Process: 223446 ExecStart=/home/iamadmin/ecobeestatus (code=exited, status=203/EXEC)
   Main PID: 223446 (code=exited, status=203/EXEC)

May 04 06:46:10 media systemd[1]: almostengr.ecobeestatus.service: Scheduled restart job, restart counter is at 5.
May 04 06:46:10 media systemd[1]: Stopped Ecobee Status Monitor by almostengr.
May 04 06:46:10 media systemd[1]: almostengr.ecobeestatus.service: Start request repeated too quickly.
May 04 06:46:10 media systemd[1]: almostengr.ecobeestatus.service: Failed with result 'exit-code'.
May 04 06:46:10 media systemd[1]: Failed to start Ecobee Status Monitor by almostengr.
</code></pre> <p><a href=#>Back to Top</a></p> <div class=pb-3> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png height=16 alt=Share> </a> </div> <!-- mobile page links --> </div> <!--  --> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div><!-- /.blog-main --> <aside class="col-md-3 blog-sidebar"> <div class="card mb-3"> <div class="card-header bg-black text-white text-center"> <h4 style="border: 0px;">Online Courses</h4> </div> <div class="card-body bg-light"> <ul class=list-unstyled> <li><a class=text-decoration-none href="https://www.youtube.com/watch?v=iujOWWbiUP0&list=PLaAJ0fv0d9WM8E2K_Ke5As-fw626yQ3tu" target=_blank> <i class></i> Drupal 8 Basics<br>FREE COURSE!</a></li> </ul> </div> </div> <div class="card mb-3"> <div class="card-header bg-black text-white text-center"> <h4 style="border: 0px;">Share This</h4> </div> <div class="card-body bg-light"> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png height=16 alt=Share> </a> </div> </div> <div class="p-1 mb-3"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> <div class="p-1 mb-3"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> </aside><!-- /.blog-sidebar --> </div><!-- /.row --> <p class=text-center><a href=#>Back To Top</a></p> </main><!-- /.container --> <footer class="blog-footer bg-black  text-left p-2"> <div class=container> <div class=row> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold rounded"> SOCIAL </li> <li class=px-3> <a href=https://github.com/almostengr><i class="bi bi-github"></i> GitHub</a> </li> <li class=px-3> <a href=https://www.instagram.com/almostengr><i class="bi bi-instagram"></i> Instagram</a> </li> <li class=px-3> <a href=https://twitter.com/almostengr><i class="bi bi-twitter"></i> Twitter</a> </li> <li class=px-3> <a href="https://www.youtube.com/c/kennythealmostengineer?sub_confirmation=1"><i class="bi bi-youtube"></i> YouTube</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold rounded"> BLOG </li> <li class=px-3> <a href=/technology><i class="bi bi-journal-text"></i> Technology</a> </li> <li class=px-3> <a href=/handyman><i class="bi bi-journal-text"></i> Handyman</a> </li> <li class=px-3> <a href=/gardening><i class="bi bi-journal-text"></i> Gardening</a> </li> <li class=px-3> <a href=/lifestyle><i class="bi bi-journal-text"></i> Lifestyle</a> </li> <li class=px-3> <a href=/cookbook><i class="bi bi-journal-text"></i> Cookbook</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold rounded"> PROJECTS </li> <li class=px-3> <a href=/lightshow><i class="bi bi-lightbulb"></i> Christmas Light Show</a> </li> <li class=px-3> <a href=/falconpitwitter><i class="bi bi-cpu-fill"></i> Falcon Pi Twitter</a> </li> <li class=px-3> <a href=/resources><i class="bi bi-bookshelf"></i> Resources</a> </li> <li class=px-3> <a href=/speaking><i class="bi bi-megaphone-fill"></i> Speaking</a> </li> <li class=px-3> <a href=/trafficpi><i class="bi bi-stoplights"></i> Traffic Pi</a> </li> <li class=px-3> <a href=/projects><i class="bi bi-journal"></i> All Projects</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold rounded"> LINKS </li> <li class=px-3> <a href=/services><i class="bi bi-briefcase"></i> Services</a> </li> <li class=px-3> <a href=/about><i class="bi bi-file-person-fill"></i> About</a> </li> <li class=px-3> <a href=/uses><i class="bi bi-tools"></i> Uses (Tools Used)</a> </li> <li class=px-3> <a href=/contact><i class="bi bi-person-lines-fill"></i> Contact</a> </li> <li class=px-3> <a href=/sitemap.xml><i class="bi bi-diagram-3"></i> Sitemap</a> </li> <li class=px-3> <a href=/privacy><i class="bi bi-shield-shaded"></i> Privacy</a> </li> </ul> </div> </div> <p class=text-center> Copyright &copy; 2021 Kenny Robinson | Website built and maintained by <a href=https://rhtservices.net target=_blank>Robinson Handy and Technology Services LLC</a> </p> <p class=text-center> Cookies are used on this website to track your visits, provide advertisements specific to you, and preferences by a third-party. By continuing to use this site, you agree to the use of cookies unless you have disabled them. More information this is available in the <a href=/privacy>Privacy Policy</a>.<br> Build Date UTC : 2021-07-02 22:28:46.839635+00:00 </p> </div> </footer> <script src=//code.jquery.com/jquery-3.5.1.slim.min.js async integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script> <script>window.jQuery || document.write('<script src="/js/vendor/jquery.slim.min.js"><\/script>')</script> <script async src=/js/bootstrap.bundle.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js></script> <script src=/js/theme.min.js defer></script> <script>let getUrl = window.location; var base_url = getUrl.protocol + "//" + getUrl.host + "/";</script> <script src=/search/main.js defer></script> <script>hljs.initHighlightingOnLoad();</script> <script type=text/javascript async>var a2a_config = a2a_config || {}; a2a_config.onclick = 1;</script> <script async src=https://static.addtoany.com/menu/page.js></script> </body> </html>