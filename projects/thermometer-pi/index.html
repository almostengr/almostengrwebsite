<!doctype html><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name=description content="The blog of Kenny Robinson"><meta name=author content="Kenny Robinson, @almostengr"><meta name=generator content=Mkdocs><title>Thermometer Pi - The Almost Engineer</title><link href=/assets/dist/css/bootstrap.min.css rel=stylesheet><style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style><link href=/css/blog.min.css rel=stylesheet><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:site_name content="The Almost Engineer"><meta name=twitter:card content=summary><meta name=twitter:site content><meta name=twitter:creator content><meta name=description content="Used a Raspberry Pi to be a thermometer that provides data to home automation system"><meta property=og:description content="Used a Raspberry Pi to be a thermometer that provides data to home automation system"><meta name=twitter:description content="Used a Raspberry Pi to be a thermometer that provides data to home automation system"><meta property=og:type content=website><meta name=robots content="index, follow"><link href=https://thealmostengineer.com/projects/thermometer-pi/ rel=canonical><meta content=https://thealmostengineer.com/projects/thermometer-pi/ property=og:url><meta content=https://thealmostengineer.com/projects/thermometer-pi/ property=twitter:url><meta name=author content="Kenny Robinson, @almostengr"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="//www.googletagmanager.com/gtag/js?id="></script><script async>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-64643711-1');</script></head> <body class=bg-dark> <nav class="navbar navbar-expand-md navbar-dark bg-dark pb-2"> <a href=/ class=navbar-brand>The Almost Engineer</a> <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarCollapse> <ul class="navbar-nav mr-auto"> <li class=nav-item><a class="nav-link text-light" href=/technology>Technology</a></li> <li class=nav-item><a class="nav-link text-light" href=/lifestyle>Living</a></li> <li class=nav-item><a class="nav-link text-light" href=/projects>Projects</a></li> <li class=nav-item><a class="nav-link text-light" href=/resources>Resources</a></li> </ul> <form class="form-inline mt-2 mt-md-0" action=https://www.google.com/search method=get> <input type=hidden name=q value=site:thealmostengineer.com> <input class="form-control mr-sm-2" type=text placeholder="Search with Google" aria-label=Search name=q> <button class="btn btn-outline-light my-2 my-sm-0" type=submit>Search</button> </form> </div> </nav> <div class="bg-light pt-3 mb-0 pb-0"> <div class=container> </div> <main role=main class=container> <div class=row> <div class="col-md-8 blog-main"> <h1>Thermometer Pi</h1> <p><img alt="Themometer with Raspberry PI" src=/images/20220424_203539.jpg></p> <h2 id=project-background>Project Background</h2> <p>A common problem that exists with US home construction is that multiple story homes were built with a single zoned HVAC system. Often times, that thermostat is on the first floor and can properly manage the temperature on the first floor. However, the second floor often times gets too hot because heat rises and cold air sinks.</p> <p>Several houses in the neighborhood have window AC units installed in the rooms on the upper floor of their house and so do I. The thing about the window units is that they have basic thermometers on them. Thus I built a .NET Core application that will read the temperature from a temperatture sensor connected to a Raspberry Pi. Home Assistant has been configured to connect to the Raspberry Pi via API to get the current temperature. Then based on automation rules, will either turn on or off the window air conditioner units.</p> <p>I have several Rapsberry Pi (or Raspberry Pis) that are used in my home and used as television set top boxes. Instead of purchasing additional devices to detect temperature, I decided to get some one-wire temperature sensors that can be connected to the Raspberry Pi that is already in the rooms that I want to monitor.</p> <p>The application was build using .NET 5.0 Web API template. The way it works is that a GET call is made to the API. The API runs a process to get the current temperature from the temperature sensor and then returns it back to the caller as a JSON object. That JSON object returns the Fahrenheit and Celsuis temperature readings.</p> <ul> <li>Year Started: 2021</li> <li>Technologies: C#</li> </ul> <h2 id=components-used>Components Used</h2> <ul> <li>Raspberry Pi</li> <li>DS18S20 Temperature Sensor</li> <li>Serial to USB Cable</li> <li><a href=https://homeassistant.io>Home Assistant (on same or different device)</a></li> <li>Belkin Wemo Smart Outlet</li> <li>Window AC Unit</li> <li>16x2 LCD Display</li> </ul> <h2 id=installation-and-setup>Installation and Setup</h2> <ul> <li>Connect the DS18S20 sensor to the Serial to USB Cable</li> <li>Install an operating system of your choosing on your Raspberry Pi</li> <li>Copy the Thermometer Pi files to the Raspberry Pi. They can be downloaded from the <a href=https://github.com/almostengr/thermometerpi>project repo</a>.</li> <li>Perform the <a href=#first-run>first run steps</a> to configure the temperature sensor</li> <li>Set up the ThermometerAPI as a system service</li> <li>Start the service</li> <li>Set up a REST sensor in Home Assistant</li> <li>Set up automations in Home Assistant</li> </ul> <h3 id=first-run>First Run</h3> <p>This is the full output when running the commands that are listed on the external resource website. Note that I did have to use sudo as it state that my user ID did not have permission to access /dev/ttyUSB0</p> <p>Install the digitemp software</p> <pre><code class=language-bash>sudo apt-get install digitemp
</code></pre> <p>After the installation has completed, then run the the command below for the configuration file to be created.</p> <pre><code class=language-bash>sudo digitemp_DS9097 -i -s /dev/ttyUSB0 -c /etc/digitemp.conf
</code></pre> <p>This command above will produce the below output.</p> <pre><code class=language-bash>DigiTemp v3.7.2 Copyright 1996-2018 by Brian C. Lane
GNU General Public License v2.0 - http://www.digitemp.com
Turning off all DS2409 Couplers

Searching the 1-Wire LAN
28711E92070000F3 : DS18B20 Temperature Sensor
ROM #0 : 28711E92070000F3
Wrote /etc/digitemp.conf
</code></pre> <p>Confirm that the sensor is readable with the configuration file.</p> <pre><code class=language-bash>sudo digitemp_DS9097 -a -q -c /etc/digitemp.conf
</code></pre> <p>This will produce the below output.</p> <pre><code class=language-bash>Apr 10 13:05:42 Sensor 0 C: 29.81 F: 85.66
</code></pre> <p>To be able to read the sensor data without using sudo, then you will need to add the user(s) to the dialout group.</p> <pre><code class=language-bash>sudo usermod -a -G dialout $USER
</code></pre> <p>Replace "$USER" with the username(s) that need to be added to the group. May need to logout or restart the system for the changes to take effect.</p> <p>To check to see what groups that the user has been added to, you can run the command</p> <pre><code class=language-bash>groups $USER
</code></pre> <p>replacing $USER with the username that you want to see.</p> <h2 id=application-as-system-service>Application as System Service</h2> <h3 id=create-system-service>Create System Service</h3> <pre><code class=language-bash>sudo cp thermometerapi.service /lib/systemd/system
sudo systemctl daemon-reload
sudo systemctl enable thermometerapi
sudo systemctl start thermometerapi
sudo systemctl status thermometerapi
</code></pre> <h3 id=remove-system-service>Remove System Service</h3> <pre><code class=language-bash>sudo systemctl disable thermometerapi
sudo systemctl stop thermometerapi
sudo systemctl status thermometerapi
sudo rm /lib/systemd/system/thermometerapi.service
</code></pre> <h3 id=application-logs>Application Logs</h3> <p>To view the application logs, run the following command</p> <pre><code class=language-bash>sudo journalctl -u thermometerapi -b
</code></pre> <p>Application logs will look similar to the below to show what the application is doing.</p> <pre><code class=language-txt>info: Microsoft.Hosting.Lifetime[0]
      Now listening on: http://[::]:8005
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Production
info: Microsoft.Hosting.Lifetime[0]
      Content root path: /home/osmc/thermometerpi
warn: Microsoft.AspNetCore.HttpsPolicy.HttpsRedirectionMiddleware[3]
      Failed to determine the https port for redirect.
info: Almostengr.ThermometerPi.Api.Controllers.ThermometerController[0]
      At 9/28/2021 9:09:14 PM temperature is 25.88
info: Almostengr.ThermometerPi.Api.Controllers.ThermometerController[0]
      At 9/28/2021 9:09:28 PM temperature is 25.88
</code></pre> <h2 id=source-code>Source Code</h2> <p>The source code is available on my <a href=https://github.com/almostengr/thermometerpi target=_blank>GitHub Repository</a>.</p> <h2 id=additional-resources>Additional Resources</h2> <p>Below are resources that were used in completing the project.</p> <p><a href=https://martybugs.net/electronics/tempsensor/usb.cgi>https://martybugs.net/electronics/tempsensor/usb.cgi</a></p> </div><!-- /.blog-main --> <aside class="col-md-4 blog-sidebar"> <div class="p-4 mb-3 bg-light rounded shadow"> <h4 class=font-italic>About Kenny</h4> <p class=mb-0> A software developer that builds and fixes things, and writes about the journey. </p> </div> <div class="p-4 shadow mb-3"> <h4 class=font-italic>Get Into Tech</h4> <p class=mb-0> Are you looking to get into a tech career or role? Check out the <a href=/resources>Resources</a> section for more information. Also check out my <a href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1" target=_blank> Tech Talk YouTube Channel</a> and <a href="https://www.facebook.com/profile.php?id=100089303142244" target=_blank> Tech Talk Facebook page</a> for video tutorials about software development, web development, and working with tech. </a> </p> </div> <div class="p-4 shadow mb-3"> <h4 class=font-italic>Connect with Me</h4> <ol class=list-unstyled> <li><a target=_blank href=https://facebook.com/rhtservicesllc>Home Improvement (Facebook)</a></li> <li><a target=_blank href="https://www.facebook.com/profile.php?id=100089303142244">Tech Talk (Facebook)</a></li> <li><a target=_blank href=https://github.com/almostengr>Github</a></li> <li><a target=_blank href=https://instagram.com/almostengr>Instagram</a></li> <li><a target=_blank href=https://stackoverflow.com/users/12875554/almostengr>StackOverflow</a></li> <li><a target=_blank href=https://www.tiktok.com/@almostengr>TikTok</a></li> <li><a target=_blank href=https://twitter.com/almostengr>Twitter</a></li> <li><a target=_blank href="https://www.youtube.com/c/RobinsonHandyandTechnologyServices?sub_confirmation=1">Home Improvement (YouTube)</a></li> <li><a target=_blank href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1">Tech Talk (YouTube)</a></li> </ol> </div> </aside><!-- /.blog-sidebar --> </div><!-- /.row --> </main><!-- /.container --> <footer class="blog-footer bg-dark text-light text-left"> <div class=container> <div><a href=# class=text-light>Back to Top</a></div> <div> <a class=text-light href=/technology>Technology</a> | <a class=text-light href=/lifestyle>Living</a> | <a class=text-light href=/projects>Projects</a> | <a class=text-light href=/resources>Resources</a> | <a class=text-light href=/services>Services</a> | <a class=text-light href=/uses>Uses</a> | <a class=text-light href=/about>About</a> | <a class=text-light href=/contact>Contact</a> | <a class=text-light href=/about/privacy>Privacy Policy</a> | <a class=text-light href=/sitemap.xml>Sitemap</a> </div> <div class> <a class=text-light target=_blank href=https://facebook.com/rhtservicesllc>Home Improvement (Facebook)</a> | <a class=text-light target=_blank href="https://www.youtube.com/c/RobinsonHandyandTechnologyServices?sub_confirmation=1">Home Improvement (YouTube)</a> | <a class=text-light target=_blank href="https://www.facebook.com/profile.php?id=100089303142244">Tech Talk (Facebook)</a> | <a class=text-light target=_blank href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1">Tech Talk (YouTube)</a> </ul> <div class> <a class=text-light target=_blank href=https://github.com/almostengr>Github</a> | <a class=text-light target=_blank href=https://instagram.com/almostengr>Instagram</a> | <a class=text-light target=_blank href=https://stackoverflow.com/users/12875554/almostengr>StackOverflow</a> | <a class=text-light target=_blank href=https://www.tiktok.com/@almostengr>TikTok</a> | <a class=text-light target=_blank href=https://twitter.com/almostengr>Twitter</a> </div> <div>Copyright &copy; 2010-2023 Kenny Robinson</div> <div>Created by <a class=text-light href=https://rhtservices.net target=_blank>Robinson Handy and Technology Services</a> </div> <div>Disclaimer: The opinions expressed here are those of mine and not representative of my employer or affiliates.</div> </div> </footer> </div> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </body> </html>