<!doctype html><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:site_name content="The Almost Engineer"><meta name=twitter:card content=summary><meta name=twitter:site content=@almostengr><meta name=twitter:creator content=@almostengr><meta name=description content="The blog of Kenny Robinson"><meta property=og:description content="The blog of Kenny Robinson"><meta name=twitter:description content="The blog of Kenny Robinson"><meta name=author content="Kenny Robinson, @almostengr"><title>Copying Infested Code | The Almost Engineer</title><meta property=og:title content="Copying Infested Code | The Almost Engineer"><meta name=twitter:title content="Copying Infested Code | The Almost Engineer"><meta property=og:type content=website><meta name=robots content="index, follow"><link href=https://thealmostengineer.com/technology/2019.09.05-copying-infested-code/ rel=canonical><meta content=https://thealmostengineer.com/technology/2019.09.05-copying-infested-code/ property=og:url><meta content=https://thealmostengineer.com/technology/2019.09.05-copying-infested-code/ property=twitter:url><link href=/css/bootstrap.min.css rel=stylesheet><!-- Custom styles for this template --><link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel=stylesheet><link href=/css/theme.min.css rel=stylesheet><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css><link rel=stylesheet href=/css/a11y-dark-theme.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=manifest href=/images/site.webmanifest><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-64643711-1"></script><script async>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date()); gtag('config', 'UA-64643711-1');</script></head> <body> <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark-red"> <a href=/ class="navbar-brand font-weight-bold text-uppercase">The Almost Engineer</a> <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarCollapse> <ul class="navbar-nav mr-auto"> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/blog>Blog</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/projects>Projects</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/resources>Resources</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/uses>Uses</a> </li> </ul> <form class="form-inline mt-2 mt-md-0" action=/search method=GET> <button class="btn btn-outline-light my-2 my-sm-0" type=submit>Search</button> </form> </div> </nav> <div class="pt-3 mt-0 bg-white"> <main role=main class=container> <div class=row> <div class="col-sm-12 col-md-9 blog-main"> <ul class=list-unstyled> <li class=list-inline-item><a href=/ >Home</a></li> <!-- <li class="list-inline-item">&raquo; <a href="">Technology</a></li> --> <li class=list-inline-item>&raquo; <a href=..>Technology</a></li> <li class=list-inline-item>&raquo; Copying Infested Code</li> </ul> <h1 class=blog-post-title> </h1> <p class="blog-post-meta text-secondary"> Posted on 2019-09-05 in <a href=/technology>Technology</a> </p> <!-- home page listing --> <p> <ul class=list-unstyled> </ul> <ul class=list-unstyled> </ul> <ul class=list-unstyled> </ul> <ul class=list-unstyled> </ul> </p> <div class=content> <h1 id=copying-infested-code>Copying Infested Code</h1> <p><img alt="Image of rotting wood" src=/images/2019.09.05-7863679378_028521b7fc_b.jpg></p> <h2 id=background>Background</h2> <p>As some of you may know, my current role consists of me building and maintaining automations. The thing about writing code is that at some point, maintenance has to be done on the code to keep it up to date and to add future enhancements and functionality. </p> <h2 id=what-kind-of-pest-the-problem>What Kind of Pest (The Problem)</h2> <p>Squirrels and rats both chew on wood. However they do not eat the same stuff, so you have to be selective with the bait that you choose. For most of the automations that I build, I use Selenium WebDriver as the automations are for web-based applications. </p> <p>Recently, we have noticed that number of automations have not been running due to “connection refused” exceptions. The connection is being refused from the automation jar not connecting to the Gecko Driver (the interface between WebDriver automation and the browser). Applying knowledge that I have of computers, normally you only see “connection refused” messages when one or more of the scenarios occur</p> <ul> <li>too many devices trying to connect at the same time, also referred to as Denial of Service Attack or Distributed Denial of Service Attack</li> <li>a firewall is rejecting the connection</li> <li>wrong password when trying to authenticate. </li> </ul> <h2 id=tracking-down-the-pest-the-analysis>Tracking Down The Pest (The Analysis)</h2> <p>I was able to immediately rule out scenarios 2 and 3 because the automation would work majority of the time. In other words, we know it is not a rat based on the evidence. Therefore, through the process of elimination, it must be a squirrel. Majority being that out of 7 days of the week that it was used, it would fail only on 1 of those days. I then did some research on the internet that provided a number of causes and solutions for the exception occurring. Some of the causes included </p> <ul> <li>the Gecko Driver process not being able to write to a log file because existing log file already exists (not in our case)</li> <li>having concurrent WebDriver automations running at the same time (which wasn’t our case as we have done several at the same time in the past)</li> <li>to the hosts file not having the localhost IP address entered (which we did not, but nslookup and ping commands both returned valid IP addresses)</li> <li>having bad code. </li> </ul> <p>I got to that last reason in the list, bad code, and I put more effort into looking into the code as we have experienced (2+ years) and inexperienced developers on our team. </p> <h2 id=found-the-nest-found-the-source-of-the-problem>Found The Nest (Found The Source Of The Problem)</h2> <p>After search through multiple automation projects, shaking my head at some of the exact examples of bad code mentioned in Robert Martin’s <em>Clean Code</em>, I hit the bullseye. Several of the automations had the same code. </p> <p>Yes… copied and pasted. First person got it working, so the next person got theirs working by doing exactly what the first person did. There's that saying about if you see one bug, there's probably another one not too far way. This would be it. To make it worse, it was multiplying everytime the code was copy and pasted. This is what I found: </p> <pre><code class=language-java>WebDriver driver = null;

try{    
    driver = new FirefoxDriver();
    driver.get(&quot;http://thealmostengineer.com&quot;);

    // other WebDriver steps go here 

    driver.quit();
    System.exit(0);
} catch (Exception exception) {
    exception.printStackTrace();
    System.exit(1);
}
</code></pre> <p>Now this is just a snippet of the actual code. Obviously, I cannot put the entire code here because of confidentiality. Do you notice the problem with this code? </p> <p>The problem here is that if an exception occurs between the <code>try</code> and <code>driver.quit();</code>, the browser and as a result, the Gecko Driver process never exits. What happens when you have too many processes running? The system will hang. What happens when there are too many connections open to a process? Some of those connections are refused. </p> <h2 id=spraying-the-bug-spray-the-solution>Spraying The Bug Spray (The Solution)</h2> <p>To now rid the varmint of our code, I had to fix the defect that I identified. The <code>driver.quit();</code> should always be executed regardless of whether the exception occurs. The reason being is that you do not want to the browser nor the Gecko Driver process running as they will hang up your system or result in the "connection refused" exceptions. So I changed the above code to the code below: </p> <pre><code class=language-java>WebDriver driver = null;
int exitCode = 1;

try{    
    driver = new FirefoxDriver();
    driver.get(&quot;http://thealmostengineer.com&quot;);

    // other WebDriver steps go here 

    exitCode = 0;
} catch (Exception exception) {
    exception.printStackTrace();
}

driver.quit();
System.exit(exitCode);
</code></pre> <p>The changes that I made: </p> <ul> <li>the <code>driver.quit();</code> has been moved outside of the try-catch block. That way it will always execute whether an exception occurs or not. Could a <code>finally</code>block been used? Yes. However, for the sake of simplifying the code I did not use one.</li> <li>I moved the <code>System.exit</code> call to the end of the code. It is best to have only one way to exit a function. If you have multiple ways to exit (or return) out of a function, code that needs to exit may not get executed because of the multiple ways out.</li> <li>I created a new integer variable called <code>exitCode</code>. Following standards for program exit code, 1 or greater means that something went wrong during execution. 0 means that everything went well during execution. Therefore, the variable defaults to 1 because you do not want your code to say that all went well when it actually did not. It is better to have a false failure and it get noticed than to have a false success and it go undetected. </li> </ul> <h2 id=conclusion>Conclusion</h2> <p>If you are going to copy the code of others, please be sure to review it first before using it as it may have defects already in it. If you do not know what the code does, then spend a few moments searching for those commands or snippets online so that you learn what they do. Using code somebody else wrote without confirming that it is not defective, is like building a chair from wood and not checking to see if it is rotting or has termites. </p> <p style="font-size: 0.9rem;font-style: italic;"> <a href=http://www.flickr.com/photos/63753633@N02/7863679378>"Rotting."</a> <span>by <a href=http://www.flickr.com/photos/63753633@N02>AisforAmy91</a> </span> is licensed under <a href="https://creativecommons.org/licenses/by-nd/2.0/?ref=ccsearch&atype=html" style="margin-right: 5px;">CC BY-ND 2.0</a> <a href="https://creativecommons.org/licenses/by-nd/2.0/?ref=ccsearch&atype=html" target=_blank rel="noopener noreferrer" style="display: inline-block;white-space: none;opacity: .7;margin-top: 2px;margin-left: 3px;height: 22px !important;"> <img style="height: inherit;margin-right: 3px;display: inline-block;" src=https://search.creativecommons.org/static/img/cc_icon.svg> <img style="height: inherit;margin-right: 3px;display: inline-block;" src=https://search.creativecommons.org/static/img/cc-by_icon.svg> <img style="height: inherit;margin-right: 3px;display: inline-block;" src=https://search.creativecommons.org/static/img/cc-nd_icon.svg></a> </p> <!-- mobile page links --> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> </div><!-- /.blog-main --> <aside class="col-md-3 blog-sidebar"> <div class="p-4 mb-3 bg-light rounded"> <h4 class=font-italic>Categories</h4> <ol class=list-unstyled> <li><a href=/handyman><i class="bi bi-wrench"></i> DIY/Handyman</a></li> <li><a href=/technology><i class="bi bi-laptop"></i> Technology</a></li> <li><a href=/speaking><i class="bi bi-megaphone-fill"></i> Speaking</a></li> <li><a href=/gardening><i class="bi bi-flower1"></i> Gardening</a></li> <li><a href=/resources><i class="bi bi-bookshelf"></i> Resources</a></li> <li><a href=/projects><i class="bi bi-journal"></i> Projects</a></li> </ol> </div> <div class="p-4 mb-3 bg-light rounded"> <h4 class=font-italic>Connect With Me</h4> <ol class=list-unstyled> <li><a href=https://github.com/almostengr target=_blank><i class="bi bi-github"></i> GitHub</a></li> </svg> <li><a href=https://instagram.com/almostengr target=_blank><i class="bi bi-instagram"></i> Instagram</a></li> </svg> <li><a href=https://www.linkedin.com/in/krobinsontech target=_blank><i class="bi bi-linkedin"></i> LinkedIn</a></li> </svg> <li><a href=https://twitter.com/almostengr target=_blank><i class="bi bi-twitter"></i> Twitter</a></li> </svg> <li><a href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1" target=_blank><i class="bi bi-youtube" &quot;></i> YouTube</a></li> </svg> </ol> </div> <div class="p-4 mb-3 bg-light rounded"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> <div class="p-4 mb-3 bg-light rounded"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> </aside><!-- /.blog-sidebar --> </div><!-- /.row --> </main><!-- /.container --> </div> <footer class="blog-footer bg-black container text-left"> <p class=text-center><a href=#>Back To Top</a></p> <ul class=list-unstyled> <li class="list-inline-item bg-white text-dark px-2 font-weight-bold"> SOCIAL </li> <li class=list-inline-item> <a href=https://github.com/almostengr><i class="bi bi-github"></i> GitHub</a> </li> <li class=list-inline-item> <a href=https://instagram.com/almostengr><i class="bi bi-instagram"></i> Instagram</a> </li> <li class=list-inline-item> <a href=https://www.linkedin.com/in/krobinsontech><i class="bi bi-linkedin"></i> LinkedIn</a> </li> <li class=list-inline-item> <a href=https://twitter.com/almostengr><i class="bi bi-twitter"></i> Twitter</a> </li> <li class=list-inline-item> <a href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1"><i class="bi bi-youtube" &quot;></i> YouTube</a> </li> </ul> <ul class=list-unstyled> <li class="list-inline-item bg-white text-dark px-2 font-weight-bold"> LINKS </li> <li class=list-inline-item> <a href=/about><i class="bi bi-file-person-fill"></i> About</a> </li> <li class=list-inline-item> <a href=/uses><i class="bi bi-tools"></i> Uses</a> </li> <li class=list-inline-item> <a href=/blog><i class="bi bi-journal-text"></i> Blog</a> </li> <li class=list-inline-item> <a href=/search><i class="bi bi-search"></i> Search</a> </li> <li class=list-inline-item> <a href=/contact><i class="bi bi-person-lines-fill"></i> Contact</a> </li> <li class=list-inline-item> <a href=/sitemap.xml><i class="bi bi-diagram-3"></i> Sitemap</a> </li> <li class=list-inline-item> <a href=/privacy><i class="bi bi-shield-shaded"></i> Privacy</a> </li> </ul> <p> Copyright &copy; 2015-2021 Kenny Robinson | Website built and maintained by <a href=https://rhtservices.net target=_blank>Robinson Handy and Technology Services LLC</a> </p> <p> Cookies are used on this website to track your visits, provide advertisements specific to you, and preferences by a third-party. By continuing to use this site, you agree to the use of cookies unless you have disabled them. More information this is available in the <a href=/privacy>Privacy Policy</a>. </p> </footer> <script src=https://code.jquery.com/jquery-3.5.1.slim.min.js async integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script> <script>window.jQuery || document.write('<script src="/js/vendor/jquery.slim.min.js"><\/script>')</script> <script async src=/js/bootstrap.bundle.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js></script> <script async src=/js/theme.min.js></script> <script>hljs.initHighlightingOnLoad();</script> <!-- Build Date UTC : 2021-02-10 01:50:28.425736+00:00 --> </body> </html>