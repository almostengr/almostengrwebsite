<!doctype html><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:site_name content="The Almost Engineer"><meta name=twitter:card content=summary><meta name=twitter:site content=@almostengr><meta name=twitter:creator content=@almostengr><meta name=description content="Convert my Drupal-based website to Wordpress-based via the database."><meta property=og:description content="Convert my Drupal-based website to Wordpress-based via the database."><meta name=twitter:description content="Convert my Drupal-based website to Wordpress-based via the database."><meta name=author content="Kenny Robinson"><title>Drupal 7 to Wordpress 5 Database Migration | The Almost Engineer, The blog of Kenny Robinson</title><meta property=og:title content="Drupal 7 to Wordpress 5 Database Migration | The Almost Engineer, The blog of Kenny Robinson"><meta name=twitter:title content="Drupal 7 to Wordpress 5 Database Migration | The Almost Engineer, The blog of Kenny Robinson"><meta name=keywords content="drupal migration, drupal to wordpress, database migration, content management system"><meta property=og:type content=website><meta property=og:video content=https://youtu.be/C2LiN99iDaY><meta name=robots content="index, follow"><link href=https://thealmostengineer.com/technology/2020.07.07-drupal-7-to-wordpress-5-migration/ rel=canonical><meta content=https://thealmostengineer.com/technology/2020.07.07-drupal-7-to-wordpress-5-migration/ property=og:url><meta content=https://thealmostengineer.com/technology/2020.07.07-drupal-7-to-wordpress-5-migration/ property=twitter:url><link href=/css/bootstrap.min.css rel=stylesheet><!-- Custom styles for this template --><link href="//fonts.googleapis.com/css?family=Playfair+Display:700,900" rel=stylesheet><link href=/css/theme.min.css rel=stylesheet><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css><link rel=stylesheet href=/css/a11y-dark-theme.min.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.min.css><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=manifest href=/images/site.webmanifest><!-- Global site tag (gtag.js) - Google Analytics --></head> <body class=bg-white> <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark-red"> <a class="navbar-brand font-weight-bold text-uppercase" href=/ title="The Almost Engineer, The blog of Kenny Robinson">The Almost Engineer</a> <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarCollapse> <ul class="navbar-nav mr-auto"> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/technology>Technology</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/handyman>Handyman</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1">YouTube</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/projects>Projects</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/services>Services</a> </li> </ul> <form class="form-inline mt-2 mt-md-0" action=/search2> <button class="btn btn-outline-light my-sm-0" type=submit>Search</button> </form> </div> </nav> <main role=main class=container> <div class=row> <div class="col-sm-12 col-md-9 blog-main"> <ul class="list-unstyled breadcrumb"> <li class=list-inline-item><a href=/ >Home</a></li> <li class=list-inline-item>&raquo; <a href=..>Technology</a></li> <li class=list-inline-item>&raquo; Drupal 7 to Wordpress 5 Database Migration</li> </ul> <h1 class=blog-post-title> Drupal 7 to Wordpress 5 Database Migration </h1> <p class="text-center blog-post-meta text-secondary font-italic"> a 4 minute read posted on 2020-07-07 last updated on 2021-06-13 by Kenny Robinson in <a href=/technology>Technology</a> </p> <div class=pb-3> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png height=16 alt=Share> </a> </div> <!-- home page listing --> <p> </p> <div class=content> <h2 id=video>Video</h2> <iframe width=560 height=315 src=https://www.youtube.com/embed/C2LiN99iDaY title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> <h2 id=links>Links</h2> <ul> <li><a href=https://wpengine.com/wp-content/uploads/2017/02/WP-WP-MigratingfromDrupalToWordPress-05-PUB.pdf target=_blank>https://wpengine.com/wp-content/uploads/2017/02/WP-WP-MigratingfromDrupalToWordPress-05-PUB.pdf</a></li> <li><a href=https://anothercoffee.net/drupal-to-wordpress-migration-sql-queries-explained/ target=_blank>https://anothercoffee.net/drupal-to-wordpress-migration-sql-queries-explained</a></li> </ul> <h2 id=database-script>Database Script</h2> <p>The original SQL file that I walked through in the video was deleted and thus I had to retype it from what was shown in the video. Therefore, if you find a mistake in the below query, I ask that you contact me with the mistake that you found so that I may correct it. Two eyes are better than one.</p> <pre><code class=language-sql>use dthealmostengineerwp;

set autocommit = 0;
commit;

-- clear all tables

truncate table awp5_commentmeta;
truncate table awp5_comments;
truncate table awp5_links;
truncate table awp5_postmeta;
truncate table awp5_posts;
truncate table awp5_termmeta;
truncate table awp5_terms;
truncate table awp5_term_relationships;
truncate table awp5_term_taxonomy;

--- clear users

delete from awp5_users where id &gt; 1;
delete from awp5_usermeta where user_id &gt; 1;

-- copy over tags

replace into dthealmostengineerwp.awp5_terms
(term_id, awp5_terms.name, slug, term_group)
select
    distinct d.tid,
    d.name,
    REPLACE(LOWER(d.name), '', '_'), 0
    FROM dthealmostengineerd7.bsal_taxonomy_term_data d
    INNER JOIN dthealmostengineerd7.bsal_taxonomy_term_hierarchy h
    USING (tid)
    WHERE (1);

INSERT INTO dthealmostengineerwp.awp5_term_taxonomy
(term_id, taxonomy, description, parent)
SELECT
DISTINCT d.tid `term_id`,
'post_tag' `taxonomy`,
ifnull(d.description, '') `description`,
h.parent `parent`
FROM
dthealmostengineerd7.bsal_taxonomy_term_data d
INNER JOIN
dthealmostengineerd6.bsal_taxonomy_term_hierarchy h
USING (tid)
INNER JOIN
dthealmostengineerd7.bsal_taxonomy_index n
USING (tid)
WHERE (1);

-- copy over posts

INSERT INTO
dthealmostengineerwp.awp5_posts(id, post_author, post_date,
    post_date_gmt,
    post_name,
    post_content,
    post_title, post_excerpt,
    post_modified, post_modified_gmt,
    post_type, post_status,
    to_ping, pinged, post_content_filtered, post_mime_type,
    comment_status)
SELECT DISTINCT n.nid `id`, n.uid `post_author`, FROM_UNIXTIME(n.created) `post_date`,
FROM_UNIXTIME(n.created) `post_date_gmt`,
IF(SUBSTR(a.alias, 11, 1) = '/', SUBSTR(a.alias, 12), a.alias) `post_name`,
body.body_value `post_content`, n.title `post_title`, '' `post_excerpt`,
FROM_UNIXTIME(n.changed) `post_modified`, FROM_UNIXTIME(n.changed) `post_modified_gmt`,
n.type `post_type`, IF(n.status= 1, 'publish', 'private') `post_status`,
'' `to_ping`, '' `pinged`, '' `post_content_filtered`, '' `post_mime_type`,
'closed' as comment_status
FROM dthealmostengineerd7.bsal_node n
INNER JOIN dthealmostengineerd7.bsal_node_revision r
USING (vid)
left outer join dthealmostengineerd7.bsal_field_data_body body
on body.revision_id = n.vid
LEFT OUTER JOIN dthealmostengineerd7.bsal_url_alias a
ON a.source=CONCAT('node/', n.nid)
WHERE n.type IN ('post', 'page', 'blog', 'article', 'portfolio_item') and
-- remove the part below if you do not have duplicate aliases in your D7 database 
a.alias not in ('client-faq', 'liftmaster-8500-review-1-year-later-almost-afro-engineered',
'install-drush-ubuntu', 'install-chrome-ubuntu', 'sow-app',
'selenium-webdriver-photo-uploader', 'changing-battery-nissan-altima-intelligent-key',
'how-start-garden', 'when-stuck-do-something-different',
'i-can-do-without-app', '7-reason-i-can-do-without-app',
'testing-markdown', 'wysiwyg-vs-markdown',
'yes-i-want-my-cornbread', 'testing-deploying', 'copying-bad-code',
'copying-termites-your-code')
;

-- combine post types

update dthealmsotengineerwp.awp5_posts
set post_type = 'post'
where post_type in ('blog', 'article', 'portfolio_item')
;

-- to define the post/tag relationship, apply the following:

INSERT INTO dthealmostengineerwp.awp5_term_relationships (object_id, term_taxonomy_id)
SELECT DISTINCT nid, tid
FROM dthealmostengineerd7.bsal_taxonomy_index;

-- update tag counts 

UPDATE dthealmostengineerwp.awp5_term_taxonomy tt
SET `count` = (SELECT COUNT(tr.object_id)
FROM dthealmostengineerwp.awp5_term_relationships tr
WHERE tr.term_taxonomy_id=tt.term_taxonomy_id);

-- Apply this query to migrate comments:

-- INSERT INTO dthealmsotengineerwp.awp5_comments(comment_post_ID, comment_date, 
-- comment_content, comment_parent, comment_author,comment_author_email, comment_author_url, 
-- comment_approved)
-- SELECT DISTINCT nid, FROM_UNIXTIME(timestamp), comment, thread, name, mail, homepage, ((status + 1) % 2)
-- FROM dthealmostengineerd7.bsal_comments;

-- Update comments count on wp_posts table.

-- UPDATE dthealmostengineerwp.awp5_posts
-- SET `comment_count` = (SELECT COUNT(`comment_post_id`)
-- FROM dthealmostengineerwp.awp5_comments
-- WHERE dthealmostengineerwp.awp5_posts.`id` = dthealmostengineerwp.awp5_comments.`comment_post_id`);

-- update links to images and files

update dthealmostengineerwp.awp5_posts
set post_content = replace(ifnull(post_content, ''), '/files', '/wp-content/uploads');

-- fix taxonomy

update ignore dthealmostengineerwp.awp5_term_relationships, dthealmostengineerwp.awp5_term_taxonomy
set dthealmostengineerwp.awp5_term_relationships.term_taxonomy_id = dthealmostengineerwp.awp5_term_taxonomy.term_taxonomy_id
where dthealmostengineerwp.awp5_term_relationships.term_taxonomy_id = dthealmostengineerwp.awp5_term_taxonomy.term_id
;

-- copy user accounts

insert into dthealmostengineerwp.awp5_users
(id, user_login, user_pass, user_nicename, user_email, user_url, user_registered, user_activation_key, user_status, display_name)
select 
uid, name, '' as user_pass, name, mail, 'http://blueprint/almostengineer/aewordpress/wordpress' as user_url,
FROM_UNIXTIME(created) as registered, '' as user_key,
0 as status, name as display_name
FROM dthealmostengineerd7.bsal_users
where uid &gt;= 2
;

-- assign users administrator status

UPDATE dthealmostengineerwp.awp5_usermeta
SET meta_value = 'a:1:{s:13:&quot;administrator&quot;;s:1:&quot;1&quot;;}'
WHERE user_id in (1) and meta_key = 'wp_capabilities';

UPDATE dthealmostengineerwp.awp5_usermeta
SET meta_value = '10'
where user_id in (1) and meta_key = 'wp_user_level';

update dthealmostengineerwp.awp5_posts
set post_author = 1
where post_author NOT IN (select distinct id from dthealmostengineerwp.awp5_users);

update dthealmostengineerwp_awp5_posts
set post_name = reverse(substring(reverse(post_name), 1, locate('/', reverse(post_name))-1));

commit;

</code></pre> <div class=pb-3> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png height=16 alt=Share> </a> </div> <!-- mobile page links --> </div> <p class=text-muted> <strong>Keywords: </strong> <a href='https://www.google.com/search?q=site:thealmostengineer.com "drupal migration"' class=text-muted target=_self>drupal migration</a>, <a href='https://www.google.com/search?q=site:thealmostengineer.com "drupal to wordpress"' class=text-muted target=_self>drupal to wordpress</a>, <a href='https://www.google.com/search?q=site:thealmostengineer.com "database migration"' class=text-muted target=_self>database migration</a>, <a href='https://www.google.com/search?q=site:thealmostengineer.com "content management system"' class=text-muted target=_self>content management system</a></p> <div class="bg-warning my-3 mx-5 p-2 rounded"> I enjoy sharing the content that you find here. I ask that you consider purchasing an item on my <a href="https://www.amazon.com/hz/wishlist/ls/38QKZTVCEAUK3?ref_=wl_share" target=_blank>Amazon Wish List</a> or you can make a <a href=/donate>donation</a>. </div> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div><!-- /.blog-main --> <aside class="col-md-3 blog-sidebar"> <!-- <div class="card mb-3">
          <div class="card-header bg-black text-white text-center">
            <h4 style="border: 0px;">Connect With Me</h4>
          </div>
          <div class="card-body bg-light">
            <ul class="list-unstyled">
              
              <li><a class="text-decoration-none" href="https://github.com/almostengr" target="_blank">
                  <i class="bi bi-github"></i> GitHub</a></li>
              
              <li><a class="text-decoration-none" href="https://www.instagram.com/almostengr" target="_blank">
                  <i class="bi bi-instagram"></i> Instagram</a></li>
              
              <li><a class="text-decoration-none" href="../.." target="_blank">
                  <i class=""></i> </a></li>
              
              <li><a class="text-decoration-none" href="https://twitter.com/almostengr" target="_blank">
                  <i class="bi bi-twitter"></i> Twitter</a></li>
              
              <li><a class="text-decoration-none" href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1" target="_blank">
                  <i class="bi bi-youtube""></i> YouTube</a></li>
              
            </ul>
          </div>
        </div> --> <div class="card mb-3"> <div class="card-header bg-black text-white text-center"> <h4 style="border: 0px;">Online Courses</h4> </div> <div class="card-body bg-light"> <ul class=list-unstyled> <li><a class=text-decoration-none href="https://www.youtube.com/watch?v=iujOWWbiUP0&list=PLaAJ0fv0d9WM8E2K_Ke5As-fw626yQ3tu" target=_blank> <i class></i> Drupal 8 Basics<br>FREE COURSE!</a></li> </ul> </div> </div> <div class="p-1 mb-3"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> <div class="p-1 mb-3"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> </aside><!-- /.blog-sidebar --> </div><!-- /.row --> <p class=text-center><a href=#>Back To Top</a></p> </main><!-- /.container --> <footer class="blog-footer bg-black  text-left p-2"> <div class=container> <div class=row> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold rounded"> SOCIAL </li> <li class=px-3> <a href=https://github.com/almostengr><i class="bi bi-github"></i> GitHub</a> </li> <li class=px-3> <a href=https://www.instagram.com/almostengr><i class="bi bi-instagram"></i> Instagram</a> </li> <li class=px-3> <a href=https://twitter.com/almostengr><i class="bi bi-twitter"></i> Twitter</a> </li> <li class=px-3> <a href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1"><i class="bi bi-youtube"></i> YouTube</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold rounded"> BLOG </li> <li class=px-3> <a href=/technology><i class="bi bi-journal-text"></i> Technology</a> </li> <li class=px-3> <a href=/handyman><i class="bi bi-journal-text"></i> Handyman</a> </li> <li class=px-3> <a href=/gardening><i class="bi bi-journal-text"></i> Gardening</a> </li> <li class=px-3> <a href=/lifestyle><i class="bi bi-journal-text"></i> Lifestyle</a> </li> <li class=px-3> <a href=/cookbook><i class="bi bi-journal-text"></i> Cookbook</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold rounded"> PROJECTS </li> <li class=px-3> <a href=/lightshow><i class="bi bi-lightbulb"></i> Christmas Light Show</a> </li> <li class=px-3> <a href=/falconpitwitter><i class="bi bi-cpu-fill"></i> Falcon Pi Twitter</a> </li> <li class=px-3> <a href=/resources><i class="bi bi-bookshelf"></i> Resources</a> </li> <li class=px-3> <a href=/speaking><i class="bi bi-megaphone-fill"></i> Speaking</a> </li> <li class=px-3> <a href=/trafficpi><i class="bi bi-stoplights"></i> Traffic Pi</a> </li> <li class=px-3> <a href=/projects><i class="bi bi-journal"></i> All Projects</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold rounded"> LINKS </li> <li class=px-3> <a href=/services><i class="bi bi-briefcase"></i> Services</a> </li> <li class=px-3> <a href=/about><i class="bi bi-file-person-fill"></i> About</a> </li> <li class=px-3> <a href=/uses><i class="bi bi-tools"></i> Uses (Tools Used)</a> </li> <li class=px-3> <a href=/contact><i class="bi bi-person-lines-fill"></i> Contact</a> </li> <li class=px-3> <a href=/sitemap.xml><i class="bi bi-diagram-3"></i> Sitemap</a> </li> <li class=px-3> <a href=/privacy><i class="bi bi-shield-shaded"></i> Privacy</a> </li> </ul> </div> </div> <p class=text-center> Copyright &copy; 2021 Kenny Robinson | Website built and maintained by <a href=https://rhtservices.net target=_blank>Robinson Handy and Technology Services LLC</a> </p> <p class=text-center> Cookies are used on this website to track your visits, provide advertisements specific to you, and preferences by a third-party. By continuing to use this site, you agree to the use of cookies unless you have disabled them. More information this is available in the <a href=/privacy>Privacy Policy</a>.<br> Build Date UTC : 2021-06-28 16:53:44.131572+00:00 </p> </div> </footer> <script src=//code.jquery.com/jquery-3.5.1.slim.min.js async integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script> <script>window.jQuery || document.write('<script src="/js/vendor/jquery.slim.min.js"><\/script>')</script> <script async src=/js/bootstrap.bundle.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js></script> <script src=/js/theme.min.js defer></script> <script>let getUrl = window.location; var base_url = getUrl.protocol + "//" + getUrl.host + "/";</script> <script src=/search/main.js defer></script> <script>hljs.initHighlightingOnLoad();</script> <script type=text/javascript async>var a2a_config = a2a_config || {}; a2a_config.onclick = 1;</script> <script async src=https://static.addtoany.com/menu/page.js></script> </body> </html>