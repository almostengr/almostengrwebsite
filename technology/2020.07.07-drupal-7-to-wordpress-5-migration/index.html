<!doctype html><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name=description content="The blog of Kenny Robinson"><meta name=author content="Kenny Robinson, @almostengr"><meta name=generator content=Mkdocs><title>Drupal 7 to Wordpress 5 Database Migration - The Almost Engineer</title><link href=/assets/dist/css/bootstrap.min.css rel=stylesheet><style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style><link href=/css/blog.min.css rel=stylesheet><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:site_name content="The Almost Engineer"><meta name=twitter:card content=summary><meta name=twitter:site content><meta name=twitter:creator content><meta name=description content="Convert my Drupal-based website to Wordpress-based via the database."><meta property=og:description content="Convert my Drupal-based website to Wordpress-based via the database."><meta name=twitter:description content="Convert my Drupal-based website to Wordpress-based via the database."><meta name=keywords content="drupal migration, drupal to wordpress, database migration, content management system"><meta property=og:type content=website><meta property=og:video content=https://youtu.be/C2LiN99iDaY><meta name=robots content="index, follow"><link href=https://thealmostengineer.com/technology/2020.07.07-drupal-7-to-wordpress-5-migration/ rel=canonical><meta content=https://thealmostengineer.com/technology/2020.07.07-drupal-7-to-wordpress-5-migration/ property=og:url><meta content=https://thealmostengineer.com/technology/2020.07.07-drupal-7-to-wordpress-5-migration/ property=twitter:url><meta name=author content="Kenny Robinson"><!-- Global site tag (gtag.js) - Google Analytics --><script async src="//www.googletagmanager.com/gtag/js?id="></script><script async>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-64643711-1');</script></head> <body class=bg-dark> <nav class="navbar navbar-expand-md navbar-dark bg-dark pb-2"> <a href=/ class=navbar-brand>The Almost Engineer</a> <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarCollapse> <ul class="navbar-nav mr-auto"> <li class=nav-item><a class="nav-link text-light" href=/technology>Technology</a></li> <li class=nav-item><a class="nav-link text-light" href=/lifestyle>Living</a></li> <li class=nav-item><a class="nav-link text-light" href=/projects>Projects</a></li> <li class=nav-item><a class="nav-link text-light" href=/resources>Resources</a></li> </ul> <form class="form-inline mt-2 mt-md-0" action=https://www.google.com/search method=get> <input type=hidden name=q value=site:thealmostengineer.com> <input class="form-control mr-sm-2" type=text placeholder="Search with Google" aria-label=Search name=q> <button class="btn btn-outline-light my-2 my-sm-0" type=submit>Search</button> </form> </div> </nav> <div class="bg-light pt-3 mb-0 pb-0"> <div class=container> </div> <main role=main class=container> <div class=row> <div class="col-md-8 blog-main"> <h1>Drupal 7 to Wordpress 5 Database Migration</h1> <h2 id=video>Video</h2> <iframe width=560 height=315 src=https://www.youtube.com/embed/C2LiN99iDaY title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> <h2 id=links>Links</h2> <ul> <li><a href=https://wpengine.com/wp-content/uploads/2017/02/WP-WP-MigratingfromDrupalToWordPress-05-PUB.pdf target=_blank>https://wpengine.com/wp-content/uploads/2017/02/WP-WP-MigratingfromDrupalToWordPress-05-PUB.pdf</a></li> <li><a href=https://anothercoffee.net/drupal-to-wordpress-migration-sql-queries-explained/ target=_blank>https://anothercoffee.net/drupal-to-wordpress-migration-sql-queries-explained</a></li> </ul> <h2 id=database-script>Database Script</h2> <p>The original SQL file that I walked through in the video was deleted and thus I had to retype it from what was shown in the video. Therefore, if you find a mistake in the below query, I ask that you contact me with the mistake that you found so that I may correct it. Two eyes are better than one.</p> <pre><code class=language-sql>use dthealmostengineerwp;

set autocommit = 0;
commit;

-- clear all tables

truncate table awp5_commentmeta;
truncate table awp5_comments;
truncate table awp5_links;
truncate table awp5_postmeta;
truncate table awp5_posts;
truncate table awp5_termmeta;
truncate table awp5_terms;
truncate table awp5_term_relationships;
truncate table awp5_term_taxonomy;

--- clear users

delete from awp5_users where id &gt; 1;
delete from awp5_usermeta where user_id &gt; 1;

-- copy over tags

replace into dthealmostengineerwp.awp5_terms
(term_id, awp5_terms.name, slug, term_group)
select
    distinct d.tid,
    d.name,
    REPLACE(LOWER(d.name), '', '_'), 0
    FROM dthealmostengineerd7.bsal_taxonomy_term_data d
    INNER JOIN dthealmostengineerd7.bsal_taxonomy_term_hierarchy h
    USING (tid)
    WHERE (1);

INSERT INTO dthealmostengineerwp.awp5_term_taxonomy
(term_id, taxonomy, description, parent)
SELECT
DISTINCT d.tid `term_id`,
'post_tag' `taxonomy`,
ifnull(d.description, '') `description`,
h.parent `parent`
FROM
dthealmostengineerd7.bsal_taxonomy_term_data d
INNER JOIN
dthealmostengineerd6.bsal_taxonomy_term_hierarchy h
USING (tid)
INNER JOIN
dthealmostengineerd7.bsal_taxonomy_index n
USING (tid)
WHERE (1);

-- copy over posts

INSERT INTO
dthealmostengineerwp.awp5_posts(id, post_author, post_date,
    post_date_gmt,
    post_name,
    post_content,
    post_title, post_excerpt,
    post_modified, post_modified_gmt,
    post_type, post_status,
    to_ping, pinged, post_content_filtered, post_mime_type,
    comment_status)
SELECT DISTINCT n.nid `id`, n.uid `post_author`, FROM_UNIXTIME(n.created) `post_date`,
FROM_UNIXTIME(n.created) `post_date_gmt`,
IF(SUBSTR(a.alias, 11, 1) = '/', SUBSTR(a.alias, 12), a.alias) `post_name`,
body.body_value `post_content`, n.title `post_title`, '' `post_excerpt`,
FROM_UNIXTIME(n.changed) `post_modified`, FROM_UNIXTIME(n.changed) `post_modified_gmt`,
n.type `post_type`, IF(n.status= 1, 'publish', 'private') `post_status`,
'' `to_ping`, '' `pinged`, '' `post_content_filtered`, '' `post_mime_type`,
'closed' as comment_status
FROM dthealmostengineerd7.bsal_node n
INNER JOIN dthealmostengineerd7.bsal_node_revision r
USING (vid)
left outer join dthealmostengineerd7.bsal_field_data_body body
on body.revision_id = n.vid
LEFT OUTER JOIN dthealmostengineerd7.bsal_url_alias a
ON a.source=CONCAT('node/', n.nid)
WHERE n.type IN ('post', 'page', 'blog', 'article', 'portfolio_item') and
-- remove the part below if you do not have duplicate aliases in your D7 database 
a.alias not in ('client-faq', 'liftmaster-8500-review-1-year-later-almost-afro-engineered',
'install-drush-ubuntu', 'install-chrome-ubuntu', 'sow-app',
'selenium-webdriver-photo-uploader', 'changing-battery-nissan-altima-intelligent-key',
'how-start-garden', 'when-stuck-do-something-different',
'i-can-do-without-app', '7-reason-i-can-do-without-app',
'testing-markdown', 'wysiwyg-vs-markdown',
'yes-i-want-my-cornbread', 'testing-deploying', 'copying-bad-code',
'copying-termites-your-code')
;

-- combine post types

update dthealmsotengineerwp.awp5_posts
set post_type = 'post'
where post_type in ('blog', 'article', 'portfolio_item')
;

-- to define the post/tag relationship, apply the following:

INSERT INTO dthealmostengineerwp.awp5_term_relationships (object_id, term_taxonomy_id)
SELECT DISTINCT nid, tid
FROM dthealmostengineerd7.bsal_taxonomy_index;

-- update tag counts 

UPDATE dthealmostengineerwp.awp5_term_taxonomy tt
SET `count` = (SELECT COUNT(tr.object_id)
FROM dthealmostengineerwp.awp5_term_relationships tr
WHERE tr.term_taxonomy_id=tt.term_taxonomy_id);

-- Apply this query to migrate comments:

-- INSERT INTO dthealmsotengineerwp.awp5_comments(comment_post_ID, comment_date, 
-- comment_content, comment_parent, comment_author,comment_author_email, comment_author_url, 
-- comment_approved)
-- SELECT DISTINCT nid, FROM_UNIXTIME(timestamp), comment, thread, name, mail, homepage, ((status + 1) % 2)
-- FROM dthealmostengineerd7.bsal_comments;

-- Update comments count on wp_posts table.

-- UPDATE dthealmostengineerwp.awp5_posts
-- SET `comment_count` = (SELECT COUNT(`comment_post_id`)
-- FROM dthealmostengineerwp.awp5_comments
-- WHERE dthealmostengineerwp.awp5_posts.`id` = dthealmostengineerwp.awp5_comments.`comment_post_id`);

-- update links to images and files

update dthealmostengineerwp.awp5_posts
set post_content = replace(ifnull(post_content, ''), '/files', '/wp-content/uploads');

-- fix taxonomy

update ignore dthealmostengineerwp.awp5_term_relationships, dthealmostengineerwp.awp5_term_taxonomy
set dthealmostengineerwp.awp5_term_relationships.term_taxonomy_id = dthealmostengineerwp.awp5_term_taxonomy.term_taxonomy_id
where dthealmostengineerwp.awp5_term_relationships.term_taxonomy_id = dthealmostengineerwp.awp5_term_taxonomy.term_id
;

-- copy user accounts

insert into dthealmostengineerwp.awp5_users
(id, user_login, user_pass, user_nicename, user_email, user_url, user_registered, user_activation_key, user_status, display_name)
select 
uid, name, '' as user_pass, name, mail, 'http://blueprint/almostengineer/aewordpress/wordpress' as user_url,
FROM_UNIXTIME(created) as registered, '' as user_key,
0 as status, name as display_name
FROM dthealmostengineerd7.bsal_users
where uid &gt;= 2
;

-- assign users administrator status

UPDATE dthealmostengineerwp.awp5_usermeta
SET meta_value = 'a:1:{s:13:&quot;administrator&quot;;s:1:&quot;1&quot;;}'
WHERE user_id in (1) and meta_key = 'wp_capabilities';

UPDATE dthealmostengineerwp.awp5_usermeta
SET meta_value = '10'
where user_id in (1) and meta_key = 'wp_user_level';

update dthealmostengineerwp.awp5_posts
set post_author = 1
where post_author NOT IN (select distinct id from dthealmostengineerwp.awp5_users);

update dthealmostengineerwp_awp5_posts
set post_name = reverse(substring(reverse(post_name), 1, locate('/', reverse(post_name))-1));

commit;

</code></pre> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div><!-- /.blog-main --> <aside class="col-md-4 blog-sidebar"> <div class="p-4 mb-3 bg-light rounded shadow"> <h4 class=font-italic>About Kenny</h4> <p class=mb-0> A software developer that builds and fixes things, and writes about the journey. </p> </div> <div class="p-4 shadow mb-3"> <h4 class=font-italic>Get Into Tech</h4> <p class=mb-0> Are you looking to get into a tech career or role? Check out the <a href=/resources>Resources</a> section for more information. Also check out my <a href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1" target=_blank> Tech Talk YouTube Channel</a> and <a href="https://www.facebook.com/profile.php?id=100089303142244" target=_blank> Tech Talk Facebook page</a> for video tutorials about software development, web development, and working with tech. </a> </p> </div> <div class="p-4 shadow mb-3"> <h4 class=font-italic>Connect with Me</h4> <ol class=list-unstyled> <li><a target=_blank href=https://github.com/almostengr>Github</a></li> <li><a target=_blank href=https://facebook.com/rhtservicesllc>Home Improvement (Facebook)</a></li> <li><a target=_blank href="https://www.youtube.com/c/RobinsonHandyandTechnologyServices?sub_confirmation=1">Home Improvement (YouTube)</a></li> <li><a target=_blank href=https://instagram.com/almostengr>Instagram</a></li> <li><a target=_blank href=https://stackoverflow.com/users/12875554/almostengr>StackOverflow</a></li> <li><a target=_blank href="https://www.facebook.com/profile.php?id=100089303142244">Tech Talk (Facebook)</a></li> <li><a target=_blank href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1">Tech Talk (YouTube)</a></li> <li><a target=_blank href=https://www.tiktok.com/@almostengr>TikTok</a></li> <li><a target=_blank href=https://twitter.com/almostengr>Twitter</a></li> </ol> </div> <div class="p-4 shadow mb-3"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> </aside><!-- /.blog-sidebar --> </div><!-- /.row --> </main><!-- /.container --> <footer class="blog-footer bg-dark text-light text-left"> <div class=container> <div> <a class="text-light pr-2" href=/technology>Technology</a> <a class="text-light pr-2" href=/lifestyle>Living</a> <a class="text-light pr-2" href=/projects>Projects</a> <a class="text-light pr-2" href=/resources>Resources</a> <a class="text-light pr-2" href=/services>Services</a> <a class="text-light pr-2" href=/uses>Uses</a> <a class="text-light pr-2" href=/about>About</a> <a class="text-light pr-2" href=/contact>Contact</a> <a class="text-light pr-2" href=/about/privacy>Privacy Policy</a> <a class="text-light pr-2" href=/sitemap.xml>Sitemap</a> </div> <div> <a class="text-light pr-2" target=_blank href=https://facebook.com/rhtservicesllc>Home Improvement (Facebook)</a> <a class="text-light pr-2" target=_blank href="https://www.youtube.com/c/RobinsonHandyandTechnologyServices?sub_confirmation=1">Home Improvement (YouTube)</a> <a class="text-light pr-2" target=_blank href="https://www.facebook.com/profile.php?id=100089303142244">Tech Talk (Facebook)</a> <a class="text-light pr-2" target=_blank href="https://www.youtube.com/channel/UC4xp-TEEIAL-4XtMVvfRaQw?sub_confirmation=1">Tech Talk (YouTube)</a> </div> <div> <a class="text-light pr-2" target=_blank href=https://github.com/almostengr>Github</a> <a class="text-light pr-2" target=_blank href=https://instagram.com/almostengr>Instagram</a> <a class="text-light pr-2" target=_blank href=https://stackoverflow.com/users/12875554/almostengr>StackOverflow</a> <a class="text-light pr-2" target=_blank href=https://www.tiktok.com/@almostengr>TikTok</a> <a class="text-light pr-2" target=_blank href=https://twitter.com/almostengr>Twitter</a> </div> <div>Copyright &copy; 2010-2023 Kenny Robinson</div> <div> Created by <a class=text-light href=https://rhtservices.net target=_blank>Robinson Handy and Technology Services</a> </div> <div> Disclaimer: The opinions expressed here are those of mine and not representative of my employer or affiliates. </div> </div> </footer> </div> </body> </html>