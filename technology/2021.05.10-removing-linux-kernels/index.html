<!doctype html><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:site_name content="The Almost Engineer"><meta name=twitter:card content=summary><meta name=twitter:site content=@almostengr><meta name=twitter:creator content=@almostengr><meta name=description content="When the kernels are left on your Linux system, they can take up unnecessary disk space. Thus they should be removed when no longer used."><meta property=og:description content="When the kernels are left on your Linux system, they can take up unnecessary disk space. Thus they should be removed when no longer used."><meta name=twitter:description content="When the kernels are left on your Linux system, they can take up unnecessary disk space. Thus they should be removed when no longer used."><meta name=author content="Kenny Robinson"><title>Removing Linux Kernels | The Almost Engineer</title><meta property=og:title content="Removing Linux Kernels | The Almost Engineer"><meta name=twitter:title content="Removing Linux Kernels | The Almost Engineer"><meta name=keywords content="linux, ubuntu, removing kernel, linux kernel, ubuntu kernel, old kernels"><meta property=og:type content=website><meta name=robots content="index, follow"><link href=https://thealmostengineer.com/technology/2021.05.10-removing-linux-kernels/ rel=canonical><meta content=https://thealmostengineer.com/technology/2021.05.10-removing-linux-kernels/ property=og:url><meta content=https://thealmostengineer.com/technology/2021.05.10-removing-linux-kernels/ property=twitter:url><link href=/css/bootstrap.min.css rel=stylesheet><!-- Custom styles for this template --><link href="//fonts.googleapis.com/css?family=Playfair+Display:700,900" rel=stylesheet><link href=/css/theme.min.css rel=stylesheet><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css><link rel=stylesheet href=/css/a11y-dark-theme.min.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.min.css><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=manifest href=/images/site.webmanifest><!-- Global site tag (gtag.js) - Google Analytics --><script async src="//www.googletagmanager.com/gtag/js?id=UA-64643711-1"></script><script async>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-64643711-1');</script></head> <body> <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark-red"> <a href=/ class="navbar-brand font-weight-bold text-uppercase">The Almost Engineer</a> <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarCollapse> <ul class="navbar-nav mr-auto"> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/technology>Technology</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/handyman>Handyman</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/gardening>Gardening</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1">YouTube</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/projects>Projects</a> </li> </ul> <form class="form-inline mt-2 mt-md-0" action=/search2> <button class="btn btn-outline-light my-2 my-sm-0" type=submit>Search</button> </form> </div> </nav> <div class="pt-3 mt-0 bg-white"> <main role=main class=container> <div class=row> <div class="col-sm-12 col-md-9 blog-main"> <ul class="list-unstyled  breadcrumb "> <li class=list-inline-item><a href=/ >Home</a></li> <li class=list-inline-item>&raquo; <a href=..>Technology</a></li> <li class=list-inline-item>&raquo; Removing Linux Kernels</li> </ul> <h1 class=blog-post-title> Removing Linux Kernels </h1> <p class="text-center blog-post-meta text-secondary"> <em> a 6 minute read posted on 2021-05-10 by Kenny Robinson in <a href=/technology>Technology</a> </em> </p> <div class=pb-3> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png height=16 alt=Share> </a> </div> <!-- home page listing --> <p><ul class=list-unstyled> </ul><ul class=list-unstyled> </ul><ul class=list-unstyled> </ul><ul class=list-unstyled> </ul><ul class=list-unstyled> </ul></p> <div class=content> <h2 id=problem>Problem</h2> <p>I noticed that I could not connect to one of my virutal machines (VM). I have a script that checks to see if the machines were offline and if so it will start them. Thus I did some investigating. What I found was not what I was expecting. </p> <p>The VM in question was in fact showing as running in the VirtualBox. What happened was that it had attempted to upgrade to the next version of the Linux kernel. Only problem was that it ran out of space when unpackaging the archive. Thus I had to remove the existing kernels on the disk before it would continue. Here's how I did it. </p> <h2 id=find-the-old-kernels>Find The Old Kernels</h2> <p>You need to find the existing kernels on the system. Since this was not my first time cleaning up the file system, I created a shell script that I can use that will display the kernels that are installed on the system. You can <a href=https://github.com/almostengr/ubuntu-automation/blob/main/utils/list_linux_kernels.sh target=_blank>view the script</a> in my <a href=https://github.com/almostengr/ubuntu-automation/tree/main/utils target=_blank>Ubuntu Automation</a> repository.</p> <p>When you run the script, it will give you an output like the following: </p> <pre><code class=language-bash>iamadmin@thepost:~/ubuntu-automation/utils$ . list_linux_kernels.sh 
rc  linux-image-4.15.0-101-generic         4.15.0-101.102                                  amd64        Signed kernel image generic
rc  linux-image-4.15.0-106-generic         4.15.0-106.107                                  amd64        Signed kernel image generic
rc  linux-image-4.15.0-108-generic         4.15.0-108.109                                  amd64        Signed kernel image generic
ii  linux-image-4.15.0-111-generic         4.15.0-111.112                                  amd64        Signed kernel image generic
rc  linux-image-4.15.0-34-generic          4.15.0-34.37                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-38-generic          4.15.0-38.41                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-39-generic          4.15.0-39.42                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-42-generic          4.15.0-42.45                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-43-generic          4.15.0-43.46                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-46-generic          4.15.0-46.49                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-47-generic          4.15.0-47.50                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-50-generic          4.15.0-50.54                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-51-generic          4.15.0-51.55                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-54-generic          4.15.0-54.58                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-58-generic          4.15.0-58.64                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-88-generic          4.15.0-88.88                                    amd64        Signed kernel image generic
rc  linux-image-4.15.0-99-generic          4.15.0-99.100                                   amd64        Signed kernel image generic
</code></pre> <p>The break down of the output is as follows. </p> <ul> <li>Lines that begin with "rc" are the ones that can be removed without any problem.</li> <li>Lines that begin with "ii" should not be removed as they are being used by the system.</li> <li>The second column of the output, represents the name of the image. This is what you will use in the next section to remove the old kernels from the system.</li> </ul> <h2 id=remove-the-old-kernels>Remove The Old Kernels</h2> <h3 id=automatically-remove-them>Automatically Remove Them</h3> <p>If you have enabled automatic updates to run on your Ubuntu system, then you can configure the old Linux images and headers to be removed.</p> <p>On Ubuntu 20.04, this would mean enabling or adding the below text to the /etc/apt/apt.conf.d/50unattended-upgrades file.</p> <p><em>NOTE: Before making updates to files in the /etc directory, I would recommend that you create a backup</em> <em>of the file or set up version control, like <a href="https://www.youtube.com/watch?v=dPm8cazYy00" target=_blank>Etckeeper</a>, for this directory.</em></p> <pre><code class=language-bash>// Remove unused automatically installed kernel-related packages
// (kernel images, kernel headers and kernel version locked tools).
Unattended-Upgrade::Remove-Unused-Kernel-Packages &quot;true&quot;;
</code></pre> <h3 id=manual-removal>Manual Removal</h3> <p>Now that you have identified the kernels to be remove, then the next step is to remove them. You can use either apt or dpkg to remove them. My preference is to use apt. Thus the command below would look like the following: </p> <pre><code class=language-bash>iamadmin@thepost:~/ubuntu-automation/utils$ sudo apt-get autoremove --purge linux-image-4.15.0-34-generic \ 
linux-image-4.15.0-38-generic linux-image-4.15.0-39-generic linux-image-4.15.0-42-generic linux-image-4.15.0-43-generic \
linux-image-4.15.0-46-generic linux-image-4.15.0-47-generic linux-image-4.15.0-50-generic linux-image-4.15.0-51-generic \
linux-image-4.15.0-54-generic linux-image-4.15.0-58-generic linux-image-4.15.0-88-generic linux-image-4.15.0-99-generic
</code></pre> <p>You will need to replace the names of each of the packages in provided in the previous section to be used in this section of the code.</p> <p>After entering the command, you may receive a prompt similiar to the one below. </p> <pre><code class=language-bash>Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages will be REMOVED:
  linux-headers-4.15.0-36* linux-headers-4.15.0-36-generic* linux-headers-4.15.0-44* linux-headers-4.15.0-44-generic* linux-headers-4.15.0-45*
  linux-headers-4.15.0-45-generic* linux-headers-4.15.0-52*
  linux-headers-4.15.0-52-generic* linux-headers-4.15.0-70* linux-headers-4.15.0-70-generic* linux-headers-4.15.0-72* linux-headers-4.15.0-72-generic*
  linux-headers-4.15.0-74* linux-headers-4.15.0-74-generic*
  linux-headers-4.15.0-76* linux-headers-4.15.0-76-generic* linux-headers-4.15.0-91* linux-headers-4.15.0-91-generic* linux-image-unsigned-4.15.0-70-generic*
0 upgraded, 0 newly installed, 19 to remove and 7 not upgraded.
After this operation, 814 MB disk space will be freed.
Do you want to continue? [Y/n] y
</code></pre> <p>If you do receive such prompt, enter in "Y". </p> <h3 id=additional-removal>Additional Removal</h3> <p>I received a message that some directories were not able to be removed. The reason being is because they were not empty. Thus the package manager would not remove these. </p> <pre><code class=language-bash>rmdir: failed to remove '/lib/modules/4.15.0-70-generic': Directory not empty
</code></pre> <p>It is safe to remove this and any other directories that are listed. To remove them, you will need to run the command: </p> <pre><code class=language-bash>sudo rm -r /lib/modules/4.15.0-70-generic
</code></pre> <p>My experience has been that sometimes the old packages are not automatically removed when Unattended Upgrades runs. I have not quite figured out why this is the case.</p> <h2 id=conclusion>Conclusion</h2> <p>Linux packages take up a lot of space on your system. By making sure you clean them off when they are no longer used, you can make sure that your system runs smoothly and does not become clogged with old junk.</p> <div class=pb-3> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png height=16 alt=Share> </a> </div> </div> <p class=text-muted> <strong>Keywords: </strong> <a href='https://www.google.com/search?q=site:thealmostengineer.com "linux"' target=_self>linux</a>, <a href='https://www.google.com/search?q=site:thealmostengineer.com "ubuntu"' target=_self>ubuntu</a>, <a href='https://www.google.com/search?q=site:thealmostengineer.com "removing kernel"' target=_self>removing kernel</a>, <a href='https://www.google.com/search?q=site:thealmostengineer.com "linux kernel"' target=_self>linux kernel</a>, <a href='https://www.google.com/search?q=site:thealmostengineer.com "ubuntu kernel"' target=_self>ubuntu kernel</a>, <a href='https://www.google.com/search?q=site:thealmostengineer.com "old kernels"' target=_self>old kernels</a></p> <!-- mobile page links --> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> <!-- </div> --> </div><!-- /.blog-main --> <aside class="col-md-3 blog-sidebar"> <div class="p-4 mb-3 bg-light rounded"> <h4 class=font-italic>Connect With Me</h4> <ol class=list-unstyled> <li><a href=https://github.com/almostengr target=_blank><i class="bi bi-github"></i> GitHub</a></li> </svg> <li><a href=https://instagram.com/almostengr target=_blank><i class="bi bi-instagram"></i> Instagram</a></li> </svg> <li><a href=https://www.linkedin.com/in/krobinsontech target=_blank><i class="bi bi-linkedin"></i> LinkedIn</a></li> </svg> <li><a href=https://twitter.com/almostengr target=_blank><i class="bi bi-twitter"></i> Twitter</a></li> </svg> <li><a href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1" target=_blank><i class="bi bi-youtube" &quot;></i> YouTube</a></li> </svg> </ol> </div> <div class="p-4 mb-3 bg-light rounded"> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png width=171 height=16 alt=Share> </a> </div> <div class="p-4 mb-3 bg-light rounded"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> <div class="p-4 mb-3 bg-light rounded"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> </aside><!-- /.blog-sidebar --> </div><!-- /.row --> </main><!-- /.container --> </div> <footer class="blog-footer bg-black container text-left"> <p class=text-center><a href=#>Back To Top</a></p> <div class=row> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold"> SOCIAL </li> <li class=px-3> <a href=https://github.com/almostengr><i class="bi bi-github"></i> GitHub</a> </li> <li class=px-3> <a href=https://instagram.com/almostengr><i class="bi bi-instagram"></i> Instagram</a> </li> <li class=px-3> <a href=https://www.linkedin.com/in/krobinsontech><i class="bi bi-linkedin"></i> LinkedIn</a> </li> <li class=px-3> <a href=https://twitter.com/almostengr><i class="bi bi-twitter"></i> Twitter</a> </li> <li class=px-3> <a href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1"><i class="bi bi-youtube"></i> YouTube</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold"> BLOG </li> <li class=px-3> <a href=/technology><i class="bi bi-journal-text"></i> Technology</a> </li> <li class=px-3> <a href=/handyman><i class="bi bi-journal-text"></i> Handyman</a> </li> <li class=px-3> <a href=/gardening><i class="bi bi-journal-text"></i> Gardening</a> </li> <li class=px-3> <a href=/lifestyle><i class="bi bi-journal-text"></i> Lifestyle</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold"> PROJECTS </li> <li class=px-3> <a href=/lightshow><i class="bi bi-lightbulb"></i> Christmas Light Show</a> </li> <li class=px-3> <a href=/falconpitwitter><i class="bi bi-cpu-fill"></i> Falcon Pi Twitter</a> </li> <li class=px-3> <a href=/projects><i class="bi bi-journal"></i> Projects (All)</a> </li> <li class=px-3> <a href=/resources><i class="bi bi-bookshelf"></i> Resources</a> </li> <li class=px-3> <a href=/speaking><i class="bi bi-megaphone-fill"></i> Speaking</a> </li> <li class=px-3> <a href=/trafficpi><i class="bi bi-stoplights"></i> Traffic Pi</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold"> LINKS </li> <li class=px-3> <a href="https://www.youtube.com/watch?v=iujOWWbiUP0&list=PLaAJ0fv0d9WM8E2K_Ke5As-fw626yQ3tu"><i class="bi bi-camera-video-fill"></i> Drupal 8 Basics Course</a> </li> <li class=px-3> <a href=/about><i class="bi bi-file-person-fill"></i> About</a> </li> <li class=px-3> <a href=/uses><i class="bi bi-tools"></i> Uses</a> </li> <li class=px-3> <a href=/contact><i class="bi bi-person-lines-fill"></i> Contact</a> </li> <li class=px-3> <a href=/sitemap.xml><i class="bi bi-diagram-3"></i> Sitemap</a> </li> <li class=px-3> <a href=/privacy><i class="bi bi-shield-shaded"></i> Privacy</a> </li> </ul> </div> </div> <p> Copyright &copy; 2021 Kenny Robinson | Website built and maintained by <a href=https://rhtservices.net target=_blank>Robinson Handy and Technology Services LLC</a> </p> <p> Cookies are used on this website to track your visits, provide advertisements specific to you, and preferences by a third-party. By continuing to use this site, you agree to the use of cookies unless you have disabled them. More information this is available in the <a href=/privacy>Privacy Policy</a>. </p> </footer> <script src=//code.jquery.com/jquery-3.5.1.slim.min.js async integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script> <script>window.jQuery || document.write('<script src="/js/vendor/jquery.slim.min.js"><\/script>')</script> <script async src=/js/bootstrap.bundle.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js></script> <script src=/js/theme.min.js defer></script> <script>let getUrl = window.location; var base_url = getUrl.protocol + "//" + getUrl.host + "/";</script> <script src=/search/main.js defer></script> <script>hljs.initHighlightingOnLoad();</script> <script type=text/javascript async>var a2a_config = a2a_config || {}; a2a_config.onclick = 1;</script> <script async src=https://static.addtoany.com/menu/page.js></script> <!-- Build Date UTC : 2021-05-26 11:43:38.049139+00:00 --> </body> </html>