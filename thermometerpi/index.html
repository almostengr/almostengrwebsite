<!doctype html><html lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:site_name content="The Almost Engineer"><meta name=twitter:card content=summary><meta name=twitter:site content=@almostengr><meta name=twitter:creator content=@almostengr><meta name=description content="Used a Raspberry Pi to be a thermometer that provides data to home automation system"><meta property=og:description content="Used a Raspberry Pi to be a thermometer that provides data to home automation system"><meta name=twitter:description content="Used a Raspberry Pi to be a thermometer that provides data to home automation system"><meta name=author content="Kenny Robinson, @almostengr"><title>Thermometer Pi | The Almost Engineer</title><meta property=og:title content="Thermometer Pi | The Almost Engineer"><meta name=twitter:title content="Thermometer Pi | The Almost Engineer"><meta property=og:type content=website><meta name=robots content="index, follow"><link href=https://thealmostengineer.com/thermometerpi/ rel=canonical><meta content=https://thealmostengineer.com/thermometerpi/ property=og:url><meta content=https://thealmostengineer.com/thermometerpi/ property=twitter:url><link href=/css/bootstrap.min.css rel=stylesheet><!-- Custom styles for this template --><link href="//fonts.googleapis.com/css?family=Playfair+Display:700,900" rel=stylesheet><link href=/css/theme.min.css rel=stylesheet><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css><link rel=stylesheet href=/css/a11y-dark-theme.min.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.min.css><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=manifest href=/images/site.webmanifest><!-- Global site tag (gtag.js) - Google Analytics --><script async src="//www.googletagmanager.com/gtag/js?id=UA-64643711-1"></script><script async>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-64643711-1');</script></head> <body> <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark-red"> <a href=/ class="navbar-brand font-weight-bold text-uppercase">The Almost Engineer</a> <button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarCollapse> <ul class="navbar-nav mr-auto"> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/technology>Technology</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/handyman>Handyman</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/gardening>Gardening</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1">YouTube</a> </li> <li class=nav-item> <a class="nav-link text-white text-uppercase" href=/projects>Projects</a> </li> </ul> <form class="form-inline mt-2 mt-md-0" action=/search2> <button class="btn btn-outline-light my-2 my-sm-0" type=submit>Search</button> </form> </div> </nav> <div class="pt-3 mt-0 bg-white"> <main role=main class=container> <div class=row> <div class="col-sm-12 col-md-9 blog-main"> <ul class="list-unstyled  breadcrumb "> <li class=list-inline-item><a href=/ >Home</a></li> <li class=list-inline-item>&raquo; <a href=..>Thermometerpi</a></li> <li class=list-inline-item>&raquo; Thermometer Pi</li> </ul> <h1 class=blog-post-title> Thermometer Pi </h1> <p class="text-center blog-post-meta text-secondary"> <em> </em> </p> <!-- home page listing --> <p><ul class=list-unstyled> </ul><ul class=list-unstyled> </ul><ul class=list-unstyled> </ul><ul class=list-unstyled> </ul><ul class=list-unstyled> </ul></p> <div class=content> <h2 id=table-of-contents>Table of Contents</h2> <p>To read more about the project, select a section below to navigate to.</p> <ul> <li><a href=#project-background>Project Background</a></li> <li><a href=#components-used>Components Used</a></li> <li><a href=#installation-and-setup>Installation and Setup</a></li> <li><a href=#application-as-system-service>Application as System Service</a></li> <li><a href=#source-code>Source Code</a></li> <li><a href=#additional-resources>Additional Resources</a></li> </ul> <h2 id=project-background>Project Background</h2> <p>A common problem that exists with US home construction is that multiple story homes were built with a single zoned system. Often times, that thermostat is on the first floor and can properly manage the temperature on the first floor. However, the second floor often times gets too hot because heat rises and cold air sinks.</p> <p>Several houses in the neighborhood have window AC units installed in the rooms on the upper floor of their house and so do I. The thing about the window units is that they do not have thermometers on them that will accurately keep the room cool. Thus I built a .NET Core application that will read the temperature from a sensor connected to a Raspberry Pi and post it to the Home Assistant API. Home Assistant will then use that data to trigger automations, like turning on an off the window AC unit.</p> <p>I have several Rapsberry Pi that are used in my home and used as television set top boxes. Instead of purchasing additional devices to detect temperature, I decided to get some one-wire temperature sensors that can be connected to the Raspberry Pi that is already in the rooms that I want to monitor.</p> <p>The application was build using .NET Core 3.1 Worker Service. The application will run the command to get the data from the temperature sensor. After getting the data, then it makes a call to Home Assistant API that provides the temperature as a state to a sensor named of your chosing.</p> <p><a href=#>Back to Top</a></p> <h2 id=components-used>Components Used</h2> <ul> <li><a href="https://www.amazon.com/gp/product/B07BC7BMHY/ref=as_li_qf_asin_il_tl?ie=UTF8&tag=rhtservicesll-20&creative=9325&linkCode=as2&creativeASIN=B07BC7BMHY&linkId=eae8899ccbef0eb26acf71cb65bef39a">Raspberry Pi</a></li> <li><a href="https://www.amazon.com/gp/product/B07MR71WVS/ref=as_li_qf_asin_il_tl?ie=UTF8&tag=rhtservicesll-20&creative=9325&linkCode=as2&creativeASIN=B07MR71WVS&linkId=bfd830515da10f922afff9a79cc33e58">DS18S20 Temperature Sensor</a></li> <li><a href="https://www.amazon.com/gp/product/B07D9R5JFK/ref=as_li_qf_asin_il_tl?ie=UTF8&tag=rhtservicesll-20&creative=9325&linkCode=as2&creativeASIN=B07D9R5JFK&linkId=e35fd9d313f055ab778e60783564078b">Serial to USB Cable</a></li> <li><a href=https://homeassistant.io>Home Assistant (on same or different device)</a></li> <li><a href="https://www.amazon.com/gp/product/B0776YH29B/ref=as_li_qf_asin_il_tl?ie=UTF8&tag=rhtservicesll-20&creative=9325&linkCode=as2&creativeASIN=B0776YH29B&linkId=34342060eb6bea8006e0dbbefb376fcf">Belkin Wemo Smart Outlet</a></li> <li><a href="https://www.amazon.com/gp/product/B085797ZFF/ref=as_li_qf_asin_il_tl?ie=UTF8&tag=rhtservicesll-20&creative=9325&linkCode=as2&creativeASIN=B085797ZFF&linkId=e38e0ec46bdea5e4c32950d147003cc8">Window AC Unit</a></li> </ul> <p><a href=#>Back to Top</a></p> <h2 id=installation-and-setup>Installation and Setup</h2> <ul> <li>Connect the <a href="https://www.amazon.com/gp/product/B07MR71WVS/ref=as_li_qf_asin_il_tl?ie=UTF8&tag=rhtservicesll-20&creative=9325&linkCode=as2&creativeASIN=B07MR71WVS&linkId=bfd830515da10f922afff9a79cc33e58">DS18S20 sensor</a> to the <a href="https://www.amazon.com/gp/product/B07D9R5JFK/ref=as_li_qf_asin_il_tl?ie=UTF8&tag=rhtservicesll-20&creative=9325&linkCode=as2&creativeASIN=B07D9R5JFK&linkId=e35fd9d313f055ab778e60783564078b">Serial to USB Cable</a></li> <li>Install an operating system of your choosing on your Raspberry Pi (<a href=https://osmc.tv/ target=_blank>OSMC</a> was installed on mine)</li> <li>Copy the ThermometerPi files to the Raspberry Pi. They can be downloaded from the <a href=https://github.com/almostengr/thermometerpi>project repo</a>.</li> <li>Configure the appsettings.json file to point to your Home Assistant instance. Also need the HA Token</li> <li>Perform the <a href=#first-run>first run steps</a> to configure the temperature sensor</li> <li>Set up the ThermometerPi as a system service</li> <li>Start the service</li> <li>Set up automations in Home Assistant using the sensor</li> </ul> <p>Eventually will do a walkthrough video on how I did my setup.</p> <p><a href=#>Back to Top</a></p> <h3 id=first-run>First Run</h3> <p>This is the full output when running the commands that are listed on the external resource website. Note that I did have to use sudo as it state that my user ID did not have permission to access /dev/ttyUSB0</p> <pre><code class=language-sh>almostengineer@aeoffice:/tmp$ sudo   digitemp_DS9097 -i -s /dev/ttyUSB0 -c /etc/digitemp.conf
DigiTemp v3.7.2 Copyright 1996-2018 by Brian C. Lane
GNU General Public License v2.0 - http://www.digitemp.com
Turning off all DS2409 Couplers

Searching the 1-Wire LAN
28711E92070000F3 : DS18B20 Temperature Sensor
ROM #0 : 28711E92070000F3
Wrote /etc/digitemp.conf
almostengineer@aeoffice:/tmp$ sudo   digitemp_DS9097 -a -q -c /etc/digitemp.conf
Apr 10 13:05:42 Sensor 0 C: 29.81 F: 85.66
almostengineer@aeoffice:/tmp$
</code></pre> <p>To be able to read the sensor data without using sudo, then you will need to add the user(s) to the dialout group.</p> <pre><code class=language-sh>sudo usermod -a -G dialout $USER
</code></pre> <p>Replace "$USER" with the username(s) that need to be added to the group. May need to logout or restart the system for the changes to take effect.</p> <p>To check to see what groups that the user has been added to, you can run the command</p> <pre><code class=language-sh>groups $USER
</code></pre> <p>replacing $USER with the username that you want to see.</p> <p><a href=#>Back to Top</a></p> <h2 id=application-as-system-service>Application as System Service</h2> <h3 id=create-system-service>Create System Service</h3> <pre><code class=language-bash>sudo cp thermometerpi.service /lib/systemd/system
sudo systemctl daemon-reload
sudo systemctl enable thermometerpi
sudo systemctl start thermometerpi
sudo systemctl status thermometerpi
</code></pre> <h3 id=remove-system-service>Remove System Service</h3> <pre><code class=language-sh>sudo systemctl disable thermometerpi
sudo systemctl stop thermometerpi
sudo systemctl status thermometerpi
sudo rm /lib/systemd/system/thermometerpi.service
</code></pre> <h3 id=application-logs>Application Logs</h3> <p>Application logs will look similar to the below to show what the application is doing.</p> <pre><code class=language-sh>Jun 01 17:50:42 osmc Almostengr.ThermometerPi.Worker[380]: Almostengr.ThermometerPi.Worker.ThermometerWorker[0] Updated: 2021-06-01T22:50:42.086745+00:00
Jun 01 17:55:43 osmc Almostengr.ThermometerPi.Worker[380]: Almostengr.ThermometerPi.Worker.ThermometerWorker[0] OK
Jun 01 17:55:43 osmc Almostengr.ThermometerPi.Worker[380]: Almostengr.ThermometerPi.Worker.ThermometerWorker[0] Updated: 2021-06-01T22:55:43.415774+00:00
Jun 01 18:00:44 osmc Almostengr.ThermometerPi.Worker[380]: Almostengr.ThermometerPi.Worker.ThermometerWorker[0] OK
Jun 01 18:00:44 osmc Almostengr.ThermometerPi.Worker[380]: Almostengr.ThermometerPi.Worker.ThermometerWorker[0] Updated: 2021-06-01T23:00:44.755279+00:00
Jun 01 18:05:46 osmc Almostengr.ThermometerPi.Worker[380]: Almostengr.ThermometerPi.Worker.ThermometerWorker[0] OK
Jun 01 18:05:46 osmc Almostengr.ThermometerPi.Worker[380]: Almostengr.ThermometerPi.Worker.ThermometerWorker[0] Updated: 2021-06-01T23:05:46.085342+00:00
</code></pre> <p><a href=#>Back to Top</a></p> <h2 id=source-code>Source Code</h2> <p>The source code is available on my <a href=https://github.com/almostengr/themometerpi target=_blank>GitHub Repository</a>.</p> <p><a href=#>Back to Top</a></p> <h2 id=additional-resources>Additional Resources</h2> <p>Below are resources that were used in completing the project.</p> <p><a href=https://martybugs.net/electronics/tempsensor/usb.cgi>https://martybugs.net/electronics/tempsensor/usb.cgi</a></p> <p><a href=#>Back to Top</a></p> <div class=pb-3> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png height=16 alt=Share> </a> </div> <!-- mobile page links --> </div> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> <!-- </div> --> </div><!-- /.blog-main --> <aside class="col-md-3 blog-sidebar"> <div class="p-4 mb-3 bg-light rounded"> <h4 class=font-italic>Connect With Me</h4> <ol class=list-unstyled> <li><a href=https://github.com/almostengr target=_blank><i class="bi bi-github"></i> GitHub</a></li> </svg> <li><a href=https://www.instagram.com/almostengr target=_blank><i class="bi bi-instagram"></i> Instagram</a></li> </svg> <li><a href=https://www.linkedin.com/in/krobinsontech target=_blank><i class="bi bi-linkedin"></i> LinkedIn</a></li> </svg> <li><a href=https://twitter.com/almostengr target=_blank><i class="bi bi-twitter"></i> Twitter</a></li> </svg> <li><a href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1" target=_blank><i class="bi bi-youtube" &quot;></i> YouTube</a></li> </svg> </ol> </div> <div class="p-4 mb-3 bg-light rounded"> <a class=a2a_dd href=https://www.addtoany.com/share> <img src=https://static.addtoany.com/buttons/share_save_171_16.png width=171 height=16 alt=Share> </a> </div> <div class="p-4 mb-3 bg-light rounded"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> <div class="p-4 mb-3 bg-light rounded"> <script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle style=display:block data-ad-client=ca-pub-4218270188842097 data-ad-slot=5189305512 data-ad-format=auto data-full-width-responsive=true></ins> <script>(adsbygoogle = window.adsbygoogle || []).push({});</script> </div> </aside><!-- /.blog-sidebar --> </div><!-- /.row --> </main><!-- /.container --> </div> <footer class="blog-footer bg-black container text-left"> <p class=text-center><a href=#>Back To Top</a></p> <div class=row> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold"> SOCIAL </li> <li class=px-3> <a href=https://github.com/almostengr><i class="bi bi-github"></i> GitHub</a> </li> <li class=px-3> <a href=https://www.instagram.com/almostengr><i class="bi bi-instagram"></i> Instagram</a> </li> <li class=px-3> <a href=https://www.linkedin.com/in/krobinsontech><i class="bi bi-linkedin"></i> LinkedIn</a> </li> <li class=px-3> <a href=https://twitter.com/almostengr><i class="bi bi-twitter"></i> Twitter</a> </li> <li class=px-3> <a href="https://www.youtube.com/channel/UC4HCouBLtXD1j1U_17aBqig?sub_confirmation=1"><i class="bi bi-youtube"></i> YouTube</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold"> BLOG </li> <li class=px-3> <a href=/technology><i class="bi bi-journal-text"></i> Technology</a> </li> <li class=px-3> <a href=/handyman><i class="bi bi-journal-text"></i> Handyman</a> </li> <li class=px-3> <a href=/gardening><i class="bi bi-journal-text"></i> Gardening</a> </li> <li class=px-3> <a href=/lifestyle><i class="bi bi-journal-text"></i> Lifestyle</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold"> PROJECTS </li> <li class=px-3> <a href=/lightshow><i class="bi bi-lightbulb"></i> Christmas Light Show</a> </li> <li class=px-3> <a href=/falconpitwitter><i class="bi bi-cpu-fill"></i> Falcon Pi Twitter</a> </li> <li class=px-3> <a href=/resources><i class="bi bi-bookshelf"></i> Resources</a> </li> <li class=px-3> <a href=/speaking><i class="bi bi-megaphone-fill"></i> Speaking</a> </li> <li class=px-3> <a href=/trafficpi><i class="bi bi-stoplights"></i> Traffic Pi</a> </li> <li class=px-3> <a href=/projects><i class="bi bi-journal"></i> All Projects</a> </li> </ul> </div> <div class="col-sm-12 col-lg-3"> <ul class=list-unstyled> <li class="bg-white text-dark px-2 mb-1 font-weight-bold"> LINKS </li> <li class=px-3> <a href="https://www.youtube.com/watch?v=iujOWWbiUP0&list=PLaAJ0fv0d9WM8E2K_Ke5As-fw626yQ3tu"><i class="bi bi-camera-video-fill"></i> Drupal 8 Basics Course</a> </li> <li class=px-3> <a href=/about><i class="bi bi-file-person-fill"></i> About</a> </li> <li class=px-3> <a href=/uses><i class="bi bi-tools"></i> Uses</a> </li> <li class=px-3> <a href=/contact><i class="bi bi-person-lines-fill"></i> Contact</a> </li> <li class=px-3> <a href=/sitemap.xml><i class="bi bi-diagram-3"></i> Sitemap</a> </li> <li class=px-3> <a href=/privacy><i class="bi bi-shield-shaded"></i> Privacy</a> </li> </ul> </div> </div> <p> Copyright &copy; 2021 Kenny Robinson | Website built and maintained by <a href=https://rhtservices.net target=_blank>Robinson Handy and Technology Services LLC</a> </p> <p> Cookies are used on this website to track your visits, provide advertisements specific to you, and preferences by a third-party. By continuing to use this site, you agree to the use of cookies unless you have disabled them. More information this is available in the <a href=/privacy>Privacy Policy</a>. </p> </footer> <script src=//code.jquery.com/jquery-3.5.1.slim.min.js async integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script> <script>window.jQuery || document.write('<script src="/js/vendor/jquery.slim.min.js"><\/script>')</script> <script async src=/js/bootstrap.bundle.min.js></script> <script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js></script> <script src=/js/theme.min.js defer></script> <script>let getUrl = window.location; var base_url = getUrl.protocol + "//" + getUrl.host + "/";</script> <script src=/search/main.js defer></script> <script>hljs.initHighlightingOnLoad();</script> <script type=text/javascript async>var a2a_config = a2a_config || {}; a2a_config.onclick = 1;</script> <script async src=https://static.addtoany.com/menu/page.js></script> <!-- Build Date UTC : 2021-06-05 13:05:56.525989+00:00 --> </body> </html>